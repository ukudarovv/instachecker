# üöÄ –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–æ–≤

## –û–±–∑–æ—Ä

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –≤ –∞–≤—Ç–æ–ø—Ä–æ–≤–µ—Ä–∫–µ. –¢–µ–ø–µ—Ä—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ, —á—Ç–æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É—Å–∫–æ—Ä—è–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å.

---

## ‚ö° –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
–ê–≤—Ç–æ–ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—É—â–µ–Ω–∞
  ‚Üì
–ü–æ–ª—É—á–µ–Ω–æ N –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
  ‚Üì
–°–æ–∑–¥–∞–µ—Ç—Å—è Semaphore (–º–∞–∫—Å 3 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö)
  ‚Üì
–ó–∞–ø—É—Å–∫–∞—é—Ç—Å—è –∑–∞–¥–∞—á–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ:
  ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ @account1 ‚îÄ‚îÄ‚îê
  ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ @account2 ‚îÄ‚îÄ‚î§‚Üí asyncio.gather()
  ‚îî‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ @account3 ‚îÄ‚îÄ‚îò
  ‚Üì
–û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö
  ‚Üì
–û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∞–¥–º–∏–Ω—É
```

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞

```python
semaphore = asyncio.Semaphore(3)  # –ú–∞–∫—Å 3 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

async def check_with_semaphore(acc):
    async with semaphore:
        await check_single_account(acc)
        await asyncio.sleep(2)  # –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏
```

**–ó–∞—á–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ?**
- –ò–∑–±–µ–∂–∞—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –æ—Ç Instagram
- –ù–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞—Ç—å —Å–∏—Å—Ç–µ–º—É
- –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤

---

## üîß –ü–∞—Ä–∞–º–µ—Ç—Ä—ã

### –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç—å

**–¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:** 3 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–∫–∏

**–ì–¥–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å:**
```python
# project/cron/auto_checker.py, —Å—Ç—Ä–æ–∫–∞ 154
semaphore = asyncio.Semaphore(3)  # –ò–∑–º–µ–Ω–∏—Ç–µ –Ω–∞ –Ω—É–∂–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- `1` - –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (–º–µ–¥–ª–µ–Ω–Ω–æ, –±–µ–∑–æ–ø–∞—Å–Ω–æ)
- `2-3` - –û–ø—Ç–∏–º–∞–ª—å–Ω–æ (–±–∞–ª–∞–Ω—Å —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏) ‚≠ê
- `5` - –ë—ã—Å—Ç—Ä–æ (—Ä–∏—Å–∫ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏)
- `10+` - –û—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ (–≤—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏)

### –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏

**–¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:** 2 —Å–µ–∫—É–Ω–¥—ã

**–ì–¥–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å:**
```python
# project/cron/auto_checker.py, —Å—Ç—Ä–æ–∫–∞ 160
await asyncio.sleep(2)  # –ò–∑–º–µ–Ω–∏—Ç–µ –Ω–∞ –Ω—É–∂–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
```

---

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏

**–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (–±—ã–ª–æ):**
```
140 –∞–∫–∫–∞—É–Ω—Ç–æ–≤ √ó 10 —Å–µ–∫ = 1400 —Å–µ–∫ = ~23 –º–∏–Ω—É—Ç—ã
```

**–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (—Å—Ç–∞–ª–æ):**
```
140 –∞–∫–∫–∞—É–Ω—Ç–æ–≤ √∑ 3 –ø–æ—Ç–æ–∫–∞ √ó 10 —Å–µ–∫ = ~467 —Å–µ–∫ = ~8 –º–∏–Ω—É—Ç
```

**–£—Å–∫–æ—Ä–µ–Ω–∏–µ: –≤ 3 —Ä–∞–∑–∞!** üöÄ

### –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã

**5 –∞–∫–∫–∞—É–Ω—Ç–æ–≤, 3 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ:**

```
0 —Å–µ–∫:  Start @acc1, @acc2, @acc3
10 —Å–µ–∫: @acc1 done ‚Üí Start @acc4
10 —Å–µ–∫: @acc2 done ‚Üí Start @acc5
10 —Å–µ–∫: @acc3 done
20 —Å–µ–∫: @acc4 done
20 —Å–µ–∫: @acc5 done

Total: ~20 —Å–µ–∫—É–Ω–¥ –≤–º–µ—Å—Ç–æ 50
```

---

## üîÑ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á

```python
async def check_single_account(acc):
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–¥–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞
    result = await check_account_hybrid(...)
    # –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
    # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤
```

### 2. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å –ø–æ–º–æ—â—å—é Semaphore

```python
semaphore = asyncio.Semaphore(3)

async def check_with_semaphore(acc):
    async with semaphore:  # –¢–æ–ª—å–∫–æ 3 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
        await check_single_account(acc)
        await asyncio.sleep(2)  # –ó–∞—â–∏—Ç–∞ –æ—Ç rate limit
```

### 3. –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

```python
tasks = [check_with_semaphore(acc) for acc in accounts]
await asyncio.gather(*tasks, return_exceptions=True)
```

### 4. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

```python
# –°—á–µ—Ç—á–∏–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Å nonlocal
nonlocal checked, found, not_found, errors
checked += 1
found += 1  # –∏–ª–∏ not_found, errors
```

---

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ó–∞—â–∏—Ç–∞ –æ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

1. **Semaphore** - –Ω–µ –±–æ–ª–µ–µ 3 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
2. **–ó–∞–¥–µ—Ä–∂–∫–∞** - 2 —Å–µ–∫—É–Ω–¥—ã –º–µ–∂–¥—É –∑–∞–ø—É—Å–∫–∞–º–∏
3. **–¢–∞–π–º–∞—É—Ç—ã** - –≤ hybrid_checker (30 —Å–µ–∫)
4. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - return_exceptions=True

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

```python
try:
    await check_single_account(acc)
except Exception as e:
    errors += 1
    print(f"Error checking @{acc.account}: {e}")
```

–û—à–∏–±–∫–∏ –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç –¥—Ä—É–≥–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏!

---

## üìà –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

### –¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|----------|
| –ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º | 3 | –ú–∞–∫—Å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ |
| –ó–∞–¥–µ—Ä–∂–∫–∞ | 2 —Å–µ–∫ | –ú–µ–∂–¥—É –∑–∞–ø—É—Å–∫–∞–º–∏ |
| –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ | –í–°–ï | max_accounts=999999 |
| –ö–∞–∂–¥—ã–µ 5 –º–∏–Ω | 5 | max_accounts=5 |

### –ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–¥ —Å–µ–±—è

**–î–ª—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ (—Ä–∏—Å–∫ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏):**
```python
semaphore = asyncio.Semaphore(5)
await asyncio.sleep(1)
```

**–î–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ (–º–µ–¥–ª–µ–Ω–Ω–æ):**
```python
semaphore = asyncio.Semaphore(1)
await asyncio.sleep(5)
```

**–û–ø—Ç–∏–º–∞–ª—å–Ω–æ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):**
```python
semaphore = asyncio.Semaphore(3)  # ‚≠ê
await asyncio.sleep(2)
```

---

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏

```
[AUTO-CHECK] Running initial full check immediately...
[AUTO-CHECK] Found 140 pending accounts to check.
[AUTO-CHECK] Checking @account1...
[AUTO-CHECK] Checking @account2...
[AUTO-CHECK] Checking @account3...
[AUTO-CHECK] ‚úÖ @account1 - FOUND
[AUTO-CHECK] üì∏ Screenshot sent and deleted for @account1
[AUTO-CHECK] Checking @account4...
...
[AUTO-CHECK] Completed!
  ‚Ä¢ Checked: 140
  ‚Ä¢ Found: 50
  ‚Ä¢ Not found: 85
  ‚Ä¢ Errors: 5
```

### –ß—Ç–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å

1. **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è** - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ 3 —Ä–∞–∑–∞ –±—ã—Å—Ç—Ä–µ–µ
2. **–û—à–∏–±–∫–∏** - –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–Ω–æ–≥–æ
3. **Rate limiting** - –µ—Å–ª–∏ –º–Ω–æ–≥–æ –æ—à–∏–±–æ–∫ ‚Üí —É–≤–µ–ª–∏—á–∏—Ç—å –∑–∞–¥–µ—Ä–∂–∫—É
4. **–°–∫—Ä–∏–Ω—à–æ—Ç—ã** - –¥–æ–ª–∂–Ω—ã –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –∏ —É–¥–∞–ª—è—Ç—å—Å—è

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

### 1. Thread Safety

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `nonlocal` –¥–ª—è —Å—á–µ—Ç—á–∏–∫–æ–≤:
```python
nonlocal checked, found, not_found, errors
```

### 2. Database Sessions

–ö–∞–∂–¥–∞—è –∑–∞–¥–∞—á–∞ —Å–æ–∑–¥–∞–µ—Ç —Å–≤–æ—é —Å–µ—Å—Å–∏—é:
```python
with SessionLocal() as s:
    ig_session = get_active_session(s, acc.user_id)
```

### 3. Event Loop

–ù–∞—á–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ:
```python
check_thread = threading.Thread(target=run_initial_check, daemon=True)
check_thread.start()
```

---

## üìù –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

```
python start_bot.py
  ‚Üì
[AUTO-CHECK] Running initial full check immediately...
[AUTO-CHECK] Found 140 pending accounts to check.
  ‚Üì
–ü—Ä–æ–≤–µ—Ä–∫–∞ 140 –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ (3 –ø–æ—Ç–æ–∫–∞)
  ‚Üì
~8 –º–∏–Ω—É—Ç ‚Üí –í—Å–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ
  ‚Üì
‚úÖ –ê–≤—Ç–æ–ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞
üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –∞–¥–º–∏–Ω—É
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

```
–ö–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç:
  ‚Üì
[AUTO-CHECK] Found 5 pending accounts to check.
  ‚Üì
–ü—Ä–æ–≤–µ—Ä–∫–∞ 5 –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ (3 –ø–æ—Ç–æ–∫–∞)
  ‚Üì
~20 —Å–µ–∫—É–Ω–¥ ‚Üí –í—Å–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ
  ‚Üì
‚úÖ –ê–≤—Ç–æ–ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞
```

---

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. ‚úÖ **–í 3 —Ä–∞–∑–∞ –±—ã—Å—Ç—Ä–µ–µ** - –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
2. ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ** - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Semaphore
3. ‚úÖ **–ù–∞–¥–µ–∂–Ω–æ** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
4. ‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ** - –ª–µ–≥–∫–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º
5. ‚úÖ **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ** - asyncio.gather()

---

## üöÄ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω —Å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–æ–π:

- ‚ö° 3 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–∫–∏
- üîí –ó–∞—â–∏—Ç–∞ –æ—Ç rate limiting
- üìä –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω—É
- üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫

**–ù–∞—Å–ª–∞–∂–¥–∞–π—Ç–µ—Å—å —Å–∫–æ—Ä–æ—Å—Ç—å—é!** üéâ

