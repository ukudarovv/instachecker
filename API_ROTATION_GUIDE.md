# üîÑ API Key Rotation Guide

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Ä–æ—Ç–∞—Ü–∏–∏ API –∫–ª—é—á–µ–π —Å –ª–∏–º–∏—Ç–æ–º 950 –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –∫–ª—é—á –≤ –¥–µ–Ω—å.

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. –†–æ—Ç–∞—Ü–∏—è –ø–æ –ø–æ—Ä—è–¥–∫—É
- API –∫–ª—é—á–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –ø–æ—Ä—è–¥–∫–µ –∏—Ö —Å–æ–∑–¥–∞–Ω–∏—è (–ø–æ `id`)
- –ö–æ–≥–¥–∞ –æ–¥–∏–Ω –∫–ª—é—á –¥–æ—Å—Ç–∏–≥–∞–µ—Ç –ª–∏–º–∏—Ç–∞ 950 –∑–∞–ø—Ä–æ—Å–æ–≤, —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π
- –ï—Å–ª–∏ –≤—Å–µ –∫–ª—é—á–∏ –∏—Å—á–µ—Ä–ø–∞–Ω—ã, —Å–∏—Å—Ç–µ–º–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É `no_available_api_key`

### 2. –ü–æ–¥—Å—á–µ—Ç –∑–∞–ø—Ä–æ—Å–æ–≤
- –ö–∞–∂–¥—ã–π —É—Å–ø–µ—à–Ω—ã–π API –∑–∞–ø—Ä–æ—Å —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å—á–µ—Ç—á–∏–∫ `qty_req`
- –°—á–µ—Ç—á–∏–∫ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –≤ –ø–æ–ª–Ω–æ—á—å (–Ω–æ–≤—ã–π –¥–µ–Ω—å)
- –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ –∫–ª—é—á–∞

### 3. –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
- –ü—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ 50 –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –∑–∞–ø—Ä–æ—Å–æ–≤ —Å–∏—Å—Ç–µ–º–∞ –≤—ã–≤–æ–¥–∏—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
- –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Ç–µ–∫—É—â–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: `API Key X: 900/950 requests used (remaining: 50)`

## –ù–∞—Å—Ç—Ä–æ–π–∫–∏

–í —Ñ–∞–π–ª–µ `.env`:
```env
API_DAILY_LIMIT=950
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π –¥–æ—Å—Ç—É–ø
```python
from project.services.api_keys import pick_best_key, incr_usage

# –ü–æ–ª—É—á–∏—Ç—å –ª—É—á—à–∏–π –¥–æ—Å—Ç—É–ø–Ω—ã–π –∫–ª—é—á
key = pick_best_key(session, user_id)

# –£–≤–µ–ª–∏—á–∏—Ç—å —Å—á–µ—Ç—á–∏–∫ –ø–æ—Å–ª–µ –∑–∞–ø—Ä–æ—Å–∞
incr_usage(session, key)
```

### –ß–µ—Ä–µ–∑ Telegram –±–æ—Ç
1. –î–æ–±–∞–≤—å—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ API –∫–ª—é—á–µ–π —á–µ—Ä–µ–∑ –º–µ–Ω—é "API"
2. –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Ö –ø–æ –ø–æ—Ä—è–¥–∫—É
3. –ü—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ –ø–µ—Ä–µ–π–¥–µ—Ç –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –∫–ª—é—á

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏ —Å–∏—Å—Ç–µ–º—ã
```
üîë API Key 4: 900/950 requests used (remaining: 50)
‚ö†Ô∏è API Key 4 is approaching limit: 50 requests remaining
üîë API Key 5: 1/950 requests used (remaining: 949)
```

### –°—Ç–∞—Ç—É—Å –∫–ª—é—á–µ–π
```python
from project.services.api_keys import get_api_keys_status

status = get_api_keys_status(session, user_id)
for key_status in status:
    print(f"Key {key_status['id']}: {key_status['qty_req']}/{key_status['limit']} requests")
```

## –ü—Ä–∏–º–µ—Ä—ã

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –û–¥–∏–Ω –∫–ª—é—á
- –ö–ª—é—á 1: 0/950 ‚Üí 950/950 (–∏—Å—á–µ—Ä–ø–∞–Ω)
- –†–µ–∑—É–ª—å—Ç–∞—Ç: `no_available_api_key`

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ù–µ—Å–∫–æ–ª—å–∫–æ –∫–ª—é—á–µ–π
- –ö–ª—é—á 1: 0/950 ‚Üí 950/950 (–∏—Å—á–µ—Ä–ø–∞–Ω)
- –ö–ª—é—á 2: 0/950 ‚Üí 100/950 (–ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å)
- –ö–ª—é—á 3: 0/950 (–æ–∂–∏–¥–∞–µ—Ç)

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ù–æ–≤—ã–π –¥–µ–Ω—å
- –í—Å–µ —Å—á–µ—Ç—á–∏–∫–∏ —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è –≤ –ø–æ–ª–Ω–æ—á—å
- –ö–ª—é—á–∏ —Å–Ω–æ–≤–∞ –¥–æ—Å—Ç—É–ø–Ω—ã —Å 0/950

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–æ—Ç–∞—Ü–∏—è** - –Ω–µ –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å –∫–ª—é—á–∏  
‚úÖ **–†–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ** - –Ω–∞–≥—Ä—É–∑–∫–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –º–µ–∂–¥—É –∫–ª—é—á–∞–º–∏  
‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –≤–∏–¥–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ –∫–ª—é—á–∞  
‚úÖ **–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è** - —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–µ—Ç –æ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–∏ –∫ –ª–∏–º–∏—Ç—É  
‚úÖ **–°–±—Ä–æ—Å –≤ –ø–æ–ª–Ω–æ—á—å** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤  

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–î–æ–±–∞–≤—å—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–ª—é—á–µ–π** - –¥–ª—è –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–π —Ä–∞–±–æ—Ç—ã
2. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ª–æ–≥–∏** - —Å–ª–µ–¥–∏—Ç–µ –∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
3. **–ü–ª–∞–Ω–∏—Ä—É–π—Ç–µ –∑–∞—Ä–∞–Ω–µ–µ** - –¥–æ–±–∞–≤–ª—è–π—Ç–µ –Ω–æ–≤—ã–µ –∫–ª—é—á–∏ –¥–æ –∏—Å—á–µ—Ä–ø–∞–Ω–∏—è —Å—Ç–∞—Ä—ã—Ö
4. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫–ª—é—á–∏** - –æ—Ç –Ω–∞–¥–µ–∂–Ω—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
