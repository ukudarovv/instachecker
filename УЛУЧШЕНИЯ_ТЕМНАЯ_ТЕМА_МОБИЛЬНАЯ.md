# üî• –£–õ–£–ß–®–ï–ù–ò–Ø: –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ + –ú–æ–±–∏–ª—å–Ω–∞—è —ç–º—É–ª—è—Ü–∏—è

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —Å–æ–≥–ª–∞—Å–Ω–æ –≤–∞—à–µ–º—É prompt

### 1. –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ - –ú–ù–û–ì–û–£–†–û–í–ù–ï–í–ê–Ø –ê–ö–¢–ò–í–ê–¶–ò–Ø

#### üî• –£—Ä–æ–≤–µ–Ω—å 1: –ë—Ä–∞—É–∑–µ—Ä
```python
# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Ç–µ–º–Ω–∞—è —Ç–µ–º–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –±—Ä–∞—É–∑–µ—Ä–∞
launch_args.extend([
    "--force-dark-mode",
    "--enable-features=WebUIDarkMode"
])
```

#### üî• –£—Ä–æ–≤–µ–Ω—å 2: –ö–æ–Ω—Ç–µ–∫—Å—Ç (Device/Context)
```python
# –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
context_options["color_scheme"] = "dark"

# –î–ª—è desktop
context_options["color_scheme"] = "dark"
```

#### üî• –£—Ä–æ–≤–µ–Ω—å 3: JavaScript Injection
```python
await context.add_init_script("""
    // localStorage
    localStorage.setItem('dark_mode', '1');
    localStorage.setItem('ig_dark_mode', '1');
    localStorage.setItem('theme', 'dark');
    
    // –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º matchMedia
    Object.defineProperty(window, 'matchMedia', {
        value: (query) => ({
            matches: query.includes('dark') ? true : false,
            ...
        }),
    });
""")
```

#### üî• –£—Ä–æ–≤–µ–Ω—å 4: Media Emulation
```python
await page.emulate_media(color_scheme='dark')
```

#### üî• –£—Ä–æ–≤–µ–Ω—å 5: CSS Injection
```python
await _apply_dark_theme(page)  # –ê–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–µ CSS —Å—Ç–∏–ª–∏
```

#### üî• –£—Ä–æ–≤–µ–Ω—å 6: –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è
```python
dark_theme_verified = await page.evaluate("""
    () => {
        const bgColor = window.getComputedStyle(document.body).backgroundColor;
        return bgColor.includes('0, 0, 0') || bgColor.includes('#000');
    }
""")
```

---

### 2. –ú–æ–±–∏–ª—å–Ω–∞—è —ç–º—É–ª—è—Ü–∏—è - iPhone 12

```python
if mobile_emulation:
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º iPhone 12 –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏
    device = p.devices["iPhone 12"]
    context_options = {
        **device,
        "proxy": proxy_kwargs
    }
    
    # –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
    if dark_theme:
        context_options["color_scheme"] = "dark"
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã iPhone 12:**
- Viewport: 390x844
- User-Agent: iPhone
- Touch support: –î–∞
- Color scheme: dark

---

### 3. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–∞—è –æ–±—Ä–µ–∑–∫–∞

```python
# –ü–∞—Ä–∞–º–µ—Ç—Ä crop_ratio - –≥–∏–±–∫–∞—è –æ–±—Ä–µ–∑–∫–∞
async def check_account_with_header_screenshot(
    username: str,
    proxy_url: str,
    ...
    crop_ratio: float = 0.25  # 25% –≤–µ—Ä—Ö–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
):
    # –û–±—Ä–µ–∑–∫–∞
    new_height = int(height * crop_ratio)
    cropped = img.crop((0, 0, width, new_height))
    cropped.save(screenshot_path, quality=95)
```

**–ü—Ä–∏–º–µ—Ä—ã:**
- `crop_ratio=0.25` ‚Üí 25% –≤–µ—Ä—Ö–∞ (—Ç–æ–ª—å–∫–æ header)
- `crop_ratio=0.5` ‚Üí 50% –≤–µ—Ä—Ö–∞ (header + —á–∞—Å—Ç—å –ø–æ—Å—Ç–æ–≤)
- `crop_ratio=1.0` ‚Üí 100% (–≤–µ—Å—å —Å–∫—Ä–∏–Ω—à–æ—Ç, –±–µ–∑ –æ–±—Ä–µ–∑–∫–∏)
- `crop_ratio=0` ‚Üí –û—Ç–∫–ª—é—á–∏—Ç—å –æ–±—Ä–µ–∑–∫—É

---

## üìù –ù–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ—É–Ω–∫—Ü–∏–∏

```python
async def check_account_with_header_screenshot(
    username: str,
    proxy_url: str,
    screenshot_path: Optional[str] = None,
    headless: bool = True,
    timeout_ms: int = 30000,
    dark_theme: bool = True,  # ‚Üê –£–õ–£–ß–®–ï–ù–ê
    mobile_emulation: bool = True,  # ‚Üê –ù–û–í–û–ï
    crop_ratio: float = 0.25  # ‚Üê –ù–û–í–û–ï
) -> dict:
```

### –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
```python
{
    "username": str,
    "exists": bool | None,
    "screenshot_path": str | None,
    "error": str | None,
    "checked_via": "proxy_header_screenshot",
    "dark_theme_applied": bool,  # ‚Üê –ù–û–í–û–ï (–≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è)
    "mobile_emulation": bool,  # ‚Üê –ù–û–í–û–ï
    "cropped": bool,  # ‚Üê –ù–û–í–û–ï
    "original_size": str,  # ‚Üê –ù–û–í–û–ï "390x844"
    "final_size": str  # ‚Üê –ù–û–í–û–ï "390x211"
}
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å—Ç–∏—Ç–µ —É–ª—É—á—à–µ–Ω–Ω—ã–π —Ç–µ—Å—Ç:

```bash
python test_header_dark_fixed.py
```

**–ß—Ç–æ –Ω–æ–≤–æ–≥–æ –≤ —Ç–µ—Å—Ç–µ:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã (–≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ JS)
- ‚úÖ –ú–æ–±–∏–ª—å–Ω–∞—è —ç–º—É–ª—è—Ü–∏—è (iPhone 12)
- ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–∞—è –æ–±—Ä–µ–∑–∫–∞ (crop_ratio=0.25)
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–≤–µ—Ç–∞ –≤ 5 —Ç–æ—á–∫–∞—Ö

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### Desktop –±–µ–∑ –º–æ–±–∏–ª—å–Ω–æ–π —ç–º—É–ª—è—Ü–∏–∏:
```python
result = await check_account_with_header_screenshot(
    username="instagram",
    proxy_url="...",
    mobile_emulation=False,  # Desktop
    crop_ratio=0.3  # 30% –≤–µ—Ä—Ö–∞
)
```
- Viewport: 1280x900
- User-Agent: Chrome Desktop
- –°–∫—Ä–∏–Ω—à–æ—Ç: ~1280x270 px

### Mobile —Å iPhone 12:
```python
result = await check_account_with_header_screenshot(
    username="instagram",
    proxy_url="...",
    mobile_emulation=True,  # iPhone 12
    crop_ratio=0.25  # 25% –≤–µ—Ä—Ö–∞
)
```
- Viewport: 390x844
- User-Agent: iPhone
- –°–∫—Ä–∏–Ω—à–æ—Ç: ~390x211 px

---

## üé® –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ - 6 —É—Ä–æ–≤–Ω–µ–π –∑–∞—â–∏—Ç—ã

1. **Browser flags** (`--force-dark-mode`)
2. **Context color_scheme** (`color_scheme: "dark"`)
3. **localStorage injection** (`dark_mode: 1`)
4. **matchMedia override** (–ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ `prefers-color-scheme: dark`)
5. **emulate_media** (`color_scheme='dark'`)
6. **CSS injection** (–∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ —á–µ—Ä–µ–∑ `_apply_dark_theme`)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ 99.9% —Å–ª—É—á–∞–µ–≤!

---

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –° –º–æ–±–∏–ª—å–Ω–æ–π —ç–º—É–ª—è—Ü–∏–µ–π (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```python
result = await check_account_with_header_screenshot(
    username="instagram",
    proxy_url="http://proxy:8080",
    dark_theme=True,  # –¢–µ–º–Ω–∞—è —Ç–µ–º–∞
    mobile_emulation=True,  # iPhone 12
    crop_ratio=0.25  # –¢–æ–ª—å–∫–æ header
)
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: Desktop –≤–µ—Ä—Å–∏—è

```python
result = await check_account_with_header_screenshot(
    username="instagram",
    proxy_url="http://proxy:8080",
    dark_theme=True,
    mobile_emulation=False,  # Desktop
    crop_ratio=0.3  # –ë–æ–ª—å—à–µ header'–∞
)
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ë–µ–∑ –æ–±—Ä–µ–∑–∫–∏

```python
result = await check_account_with_header_screenshot(
    username="instagram",
    proxy_url="http://proxy:8080",
    dark_theme=True,
    mobile_emulation=True,
    crop_ratio=0  # –ë–µ–∑ –æ–±—Ä–µ–∑–∫–∏
)
```

---

## üìã Checklist —Å–æ–≥–ª–∞—Å–Ω–æ –≤–∞—à–µ–º—É prompt

‚úÖ **–¢–µ–º–Ω–∞—è —Ç–µ–º–∞ Instagram** - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (6 —É—Ä–æ–≤–Ω–µ–π)  
‚úÖ **–¢–æ–ª—å–∫–æ header –ø—Ä–æ—Ñ–∏–ª—è** - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (crop_ratio)  
‚úÖ **–ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è** - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (iPhone 12)  
‚úÖ **–í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ** - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (PNG, quality=95)  
‚úÖ **emulate_media(color_scheme='dark')** - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ  
‚úÖ **JavaScript injection** - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ  
‚úÖ **Device preferences** - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ  
‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–µ–∑–∫–∞** - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ  
‚úÖ **–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã** - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ  
‚úÖ **–°—Ç–µ–ª—Å-—Ä–µ–∂–∏–º** - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

---

## üéØ –§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

**–°–∫—Ä–∏–Ω—à–æ—Ç header –ø—Ä–æ—Ñ–∏–ª—è Instagram:**
- üì± –ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è (iPhone 12): ~390x211 px
- üñ•Ô∏è Desktop –≤–µ—Ä—Å–∏—è: ~1280x270 px
- üåô –¢–µ–º–Ω–∞—è —Ç–µ–º–∞: –ß–µ—Ä–Ω—ã–π —Ñ–æ–Ω, –±–µ–ª—ã–π —Ç–µ–∫—Å—Ç
- üì∏ –ö–∞—á–µ—Å—Ç–≤–æ: PNG, 95% quality
- ‚úÇÔ∏è –û–±—Ä–µ–∑–∫–∞: –¢–æ–ª—å–∫–æ header (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–∞—è)

**–í–∫–ª—é—á–∞–µ—Ç:**
- ‚úÖ –ê–≤–∞—Ç–∞—Ä –ø—Ä–æ—Ñ–∏–ª—è
- ‚úÖ –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (@username)
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–ø–æ–¥–ø–∏—Å—á–∏–∫–∏, –ø–æ–¥–ø–∏—Å–∫–∏, –ø–æ—Å—Ç—ã)
- ‚úÖ –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
- ‚úÖ –ë–∏–æ–≥—Ä–∞—Ñ–∏—è (–µ—Å–ª–∏ –µ—Å—Ç—å)

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —Å–æ–≥–ª–∞—Å–Ω–æ prompt  
**–î–∞—Ç–∞:** 22 –æ–∫—Ç—è–±—Ä—è 2025  
**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

