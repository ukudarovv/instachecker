# Telegram Mini App –¥–ª—è Instagram Login

## üéØ –ß—Ç–æ —ç—Ç–æ?

Telegram Mini App, –∫–æ—Ç–æ—Ä–æ–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –≤—Ö–æ–¥–∏—Ç—å –≤ Instagram –ø—Ä—è–º–æ –≤–Ω—É—Ç—Ä–∏ Telegram –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞—Ç—å cookies –¥–ª—è –±–æ—Ç–∞.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ó–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

```bash
cd telegram_mini_app
python server.py 8000
```

–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ `http://localhost:8000`

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ BotFather

1. –û—Ç–∫—Ä–æ–π—Ç–µ [@BotFather](https://t.me/BotFather)
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/mybots`
3. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
4. –ù–∞–∂–º–∏—Ç–µ `Bot Settings` ‚Üí `Menu Button`
5. –í—ã–±–µ—Ä–∏—Ç–µ `Configure Menu Button`
6. –û—Ç–ø—Ä–∞–≤—å—Ç–µ URL –≤–∞—à–µ–≥–æ Mini App: `https://yourdomain.com`
7. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏: `üîê –í–æ–π—Ç–∏ –≤ Instagram`

### 3. –î–µ–ø–ª–æ–π –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω

‚ö†Ô∏è **Telegram —Ç—Ä–µ–±—É–µ—Ç HTTPS –¥–ª—è Mini Apps!**

#### –í–∞—Ä–∏–∞–Ω—Ç A: GitHub Pages (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)

1. –°–æ–∑–¥–∞–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ GitHub
2. –ó–∞–≥—Ä—É–∑–∏—Ç–µ `index.html` –≤ –∫–æ—Ä–µ–Ω—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
3. –í–∫–ª—é—á–∏—Ç–µ GitHub Pages –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ URL: `https://yourusername.github.io/repo-name/`

#### –í–∞—Ä–∏–∞–Ω—Ç B: Vercel (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Vercel CLI:
```bash
npm i -g vercel
```

2. –î–µ–ø–ª–æ–π:
```bash
cd telegram_mini_app
vercel --prod
```

3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π URL

#### –í–∞—Ä–∏–∞–Ω—Ç C: Netlify (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)

1. –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –ø–∞–ø–∫—É `telegram_mini_app` –Ω–∞ [netlify.com/drop](https://app.netlify.com/drop)
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π URL

#### –í–∞—Ä–∏–∞–Ω—Ç D: –°–≤–æ–π —Å–µ—Ä–≤–µ—Ä

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Nginx
2. –ü–æ–ª—É—á–∏—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (Let's Encrypt)
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Nginx –¥–ª—è —Ä–∞–∑–¥–∞—á–∏ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤
4. –£–∫–∞–∂–∏—Ç–µ domain –≤ BotFather

## üîß –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–æ—Ç–æ–º

### –û–±–Ω–æ–≤–∏—Ç–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤ –±–æ—Ç–µ

–î–æ–±–∞–≤—å—Ç–µ –≤ `project/handlers/ig_menu.py`:

```python
# Handle Web App data
@dp.message_handler(content_types=['web_app_data'])
async def handle_web_app_data(message: types.Message):
    """Handle data from Telegram Mini App."""
    try:
        data = json.loads(message.web_app_data.data)
        
        if data.get('action') == 'instagram_cookies':
            cookies = data.get('cookies')
            
            if not cookies or len(cookies) == 0:
                await message.answer("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å cookies")
                return
            
            # Check for sessionid
            has_sessionid = any(c.get('name') == 'sessionid' for c in cookies)
            if not has_sessionid:
                await message.answer("‚ö†Ô∏è –í cookies –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç sessionid. –í–æ–π–¥–∏—Ç–µ –≤ Instagram –≤ Mini App.")
                return
            
            # Save session
            settings = get_settings()
            fernet = OptionalFernet(settings.encryption_key)
            
            with SessionLocal() as s:
                user = get_or_create_user(s, message.from_user)
                
                # Extract username from cookies or ask user
                ig_username = data.get('username', 'webapp_user')
                
                obj = save_session(
                    session=s,
                    user_id=user.id,
                    ig_username=ig_username,
                    cookies_json=cookies,
                    fernet=fernet,
                )
            
            await message.answer(
                f"‚úÖ –°–µ—Å—Å–∏—è –∏–∑ Mini App —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞! (id={obj.id})\n\n"
                f"üéâ –¢–µ–ø–µ—Ä—å –º–æ–∂–µ—Ç–µ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∞–∫–∫–∞—É–Ω—Ç—ã —á–µ—Ä–µ–∑ Instagram.",
                reply_markup=instagram_menu_kb()
            )
            
    except Exception as e:
        print(f"Error handling web app data: {e}")
        await message.answer(f"‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö: {str(e)}")
```

### –û–±–Ω–æ–≤–∏—Ç–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É

–í `project/keyboards.py` –¥–æ–±–∞–≤—å—Ç–µ:

```python
def instagram_menu_kb() -> dict:
    """Instagram menu with Mini App button."""
    return {
        "keyboard": [
            [{"text": "–ú–æ–∏ IG-—Å–µ—Å—Å–∏–∏"}],
            [{"text": "–î–æ–±–∞–≤–∏—Ç—å IG-—Å–µ—Å—Å–∏—é"}],
            [
                {
                    "text": "üîê –í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Mini App",
                    "web_app": {"url": "https://yourdomain.com"}
                }
            ],
            [{"text": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ IG"}],
            [{"text": "–ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é"}]
        ],
        "resize_keyboard": True
    }
```

## üì± –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç** –∫–Ω–æ–ø–∫—É "üîê –í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Mini App"
2. **–û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è WebView** —Å Instagram –≤–Ω—É—Ç—Ä–∏ Telegram
3. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Ö–æ–¥–∏—Ç** –≤ Instagram –∫–∞–∫ –æ–±—ã—á–Ω–æ
4. **–ù–∞–∂–∏–º–∞–µ—Ç "–ì–æ—Ç–æ–≤–æ"** –≤ Mini App
5. **Cookies –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ –±–æ—Ç
6. **–ë–æ—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç** —Å–µ—Å—Å–∏—é –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

## ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ CORS

–ò–∑-–∑–∞ –ø–æ–ª–∏—Ç–∏–∫–∏ Same-Origin Policy –±—Ä–∞—É–∑–µ—Ä **–Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç** Mini App –Ω–∞–ø—Ä—è–º—É—é –ø–æ–ª—É—á–∞—Ç—å cookies –∏–∑ iframe —Å Instagram.

### –†–µ—à–µ–Ω–∏—è:

**–†–µ—à–µ–Ω–∏–µ 1: –ü–æ–ø—Ä–æ—Å–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å cookies –≤—Ä—É—á–Ω—É—é**
- –ü–æ—Å–ª–µ –≤—Ö–æ–¥–∞ –≤ Instagram
- –û—Ç–∫—Ä—ã—Ç—å –∫–æ–Ω—Å–æ–ª—å (F12)
- –í—ã–ø–æ–ª–Ω–∏—Ç—å —Å–∫—Ä–∏–ø—Ç —ç–∫—Å–ø–æ—Ä—Ç–∞
- –í—Å—Ç–∞–≤–∏—Ç—å –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞

**–†–µ—à–µ–Ω–∏–µ 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä**
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–≤–æ–π –ø—Ä–æ–∫—Å–∏
- –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫ Instagram
- –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å cookies –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

**–†–µ—à–µ–Ω–∏–µ 3: Browser Extension (–ª—É—á—à–∏–π –≤–∞—Ä–∏–∞–Ω—Ç)**
- –°–æ–∑–¥–∞—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞
- –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å cookies
- –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å –≤ –±–æ—Ç —á–µ—Ä–µ–∑ Web App

## üé® –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è

### –ò–∑–º–µ–Ω–∏—Ç—å —Ç–µ–º—É

–í `index.html` –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ Telegram:

```css
--tg-theme-bg-color
--tg-theme-text-color
--tg-theme-hint-color
--tg-theme-link-color
--tg-theme-button-color
--tg-theme-button-text-color
```

### –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–æ—Ç–∏–ø

```html
<div class="logo">
    <img src="your-logo.png" alt="Logo">
</div>
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **HTTPS –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω** - Telegram —Ç—Ä–µ–±—É–µ—Ç HTTPS –¥–ª—è Mini Apps
2. **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö** - –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ `initData` –æ—Ç Telegram
3. **–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è cookies
4. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞** - –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [Telegram Mini Apps](https://core.telegram.org/bots/webapps)
- [Telegram Web App API](https://core.telegram.org/bots/webapps#initializing-mini-apps)
- [BotFather Menu Button](https://core.telegram.org/bots/webapps#launching-mini-apps-from-the-menu-button)

## üêõ Troubleshooting

### Mini App –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ URL –∏—Å–ø–æ–ª—å–∑—É–µ—Ç HTTPS
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ URL –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ BotFather

### Cookies –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è
- –ò–∑-–∑–∞ CORS —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä—É—á–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å
- –ò–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä

### –û—à–∏–±–∫–∞ "Invalid initData"
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç–µ –ø–æ–¥–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π bot token –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

## üí° –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

–ï—Å–ª–∏ Mini App –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –∏–∑-–∑–∞ CORS:

1. **–ë—É–∫–º–∞—Ä–∫–ª–µ—Ç** - –∑–∞–∫–ª–∞–¥–∫–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ cookies
2. **Browser Extension** - —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —ç–∫—Å–ø–æ—Ä—Ç–∞
3. **Desktop App** - Electron –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ cookies
4. **–†—É—á–Ω–æ–π –∏–º–ø–æ—Ä—Ç** - —Å–∫—Ä–∏–ø—Ç –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (—Ç–µ–∫—É—â–µ–µ —Ä–µ—à–µ–Ω–∏–µ)

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

**–¢–µ–∫—É—â–µ–µ —Ä–µ—à–µ–Ω–∏–µ —Å —Ä—É—á–Ω—ã–º –∏–º–ø–æ—Ä—Ç–æ–º cookies —á–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å** –æ—Å—Ç–∞–µ—Ç—Å—è —Å–∞–º—ã–º –Ω–∞–¥–µ–∂–Ω—ã–º –∏ –ø—Ä–æ—Å—Ç—ã–º —Å–ø–æ—Å–æ–±–æ–º –∏–∑-–∑–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –±—Ä–∞—É–∑–µ—Ä–∞ —Å CORS.

Mini App –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ **—É–¥–æ–±–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** –¥–ª—è –≤—Ö–æ–¥–∞, –Ω–æ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —ç—Ç–∞–ø (–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ cookies) –≤—Å–µ —Ä–∞–≤–Ω–æ –±—É–¥–µ—Ç —Ä—É—á–Ω—ã–º.

