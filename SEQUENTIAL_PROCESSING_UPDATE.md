# üîÑ –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –∞–≤—Ç–æ–ø—Ä–æ–≤–µ—Ä–∫–∏

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞

–†–∞–Ω–µ–µ —Å–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É:
- –ö–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ
- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏ —Å–æ–∑–¥–∞–≤–∞–ª–∏ –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ —Å–∏—Å—Ç–µ–º—É
- –°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è concurrency

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

–ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É:
- –í—Å–µ –∞–∫–∫–∞—É–Ω—Ç—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –≤ –æ–¥–Ω–æ–º –≤—Ç–æ—Ä–∏—á–Ω–æ–º –ø–æ—Ç–æ–∫–µ
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –æ–¥–∏–Ω –∑–∞ –¥—Ä—É–≥–∏–º
- –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –±–µ–∑ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç—å—é

## üîß –ò–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –£–¥–∞–ª–µ–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
```python
# –£–¥–∞–ª–µ–Ω–æ:
def calculate_optimal_concurrency(total_tasks: int, task_type: str = "accounts") -> int
async def run_limited_parallel(tasks, max_concurrent=None, task_type="accounts")
```

### 2. –ò–∑–º–µ–Ω–µ–Ω–∞ –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏
```python
# –ë—ã–ª–æ (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ):
tasks = []
for user_id, user_accounts in accounts_by_user.items():
    task = check_user_accounts(user_id, user_accounts, SessionLocal, fernet, bot)
    tasks.append(task)

results = await run_limited_parallel(tasks, task_type="users")

# –°—Ç–∞–ª–æ (–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ):
for user_id, user_accounts in accounts_by_user.items():
    print(f"[AUTO-CHECK] üë§ Processing user {user_id} with {len(user_accounts)} accounts...")
    try:
        result = await check_user_accounts(user_id, user_accounts, SessionLocal, fernet, bot)
        # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞...
    except Exception as e:
        print(f"[AUTO-CHECK] ‚ùå Error processing user {user_id}: {e}")
```

### 3. –û–±–Ω–æ–≤–ª–µ–Ω—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```python
# –û–±–Ω–æ–≤–ª–µ–Ω–æ:
async def check_pending_accounts(SessionLocal: sessionmaker, bot=None, max_accounts: int = 5, notify_admin: bool = True):
    """
    Check pending accounts (done=False) for all users sequentially in one thread.
    """

async def check_user_accounts(user_id: int, user_accounts: list, SessionLocal: sessionmaker, fernet: OptionalFernet, bot=None):
    """
    Check accounts for a specific user using new API + Proxy logic (sequential processing).
    """
```

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

### 1. –£–ø—Ä–æ—â–µ–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- ‚úÖ –£–±—Ä–∞–Ω–∞ —Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è concurrency
- ‚úÖ –ù–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤ —Å–µ–º–∞—Ñ–æ—Ä–∞—Ö –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è—Ö –ø–æ—Ç–æ–∫–æ–≤
- ‚úÖ –ü—Ä–æ—Å—Ç–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

### 2. –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ —Å–∏—Å—Ç–µ–º—É
- ‚úÖ –ú–µ–Ω—å—à–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –°–Ω–∏–∂–µ–Ω–∞ –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –ø—Ä–æ–∫—Å–∏ —Å–µ—Ä–≤–µ—Ä—ã
- ‚úÖ –ë–æ–ª–µ–µ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤

### 3. –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞
- ‚úÖ –õ–µ–≥—á–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏
- ‚úÖ –ü—Ä–æ—Å—Ç—ã–µ –ª–æ–≥–∏ –±–µ–∑ —Å–ª–æ–∂–Ω–æ–π –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–∏
- ‚úÖ –ü–æ–Ω—è—Ç–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### 4. –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ –ú–µ–Ω—å—à–µ race conditions
- ‚úÖ –ë–æ–ª–µ–µ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
- ‚úÖ –ü—Ä–æ—â–µ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

## üìä –õ–æ–≥–∏ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

```
[AUTO-CHECK] üöÄ Starting sequential check for 50 accounts...
[AUTO-CHECK] üìä Found 3 users with pending accounts
[AUTO-CHECK] üë§ Processing user 123 with 20 accounts...
[AUTO-CHECK] üßµ User 123 check complete: 20 checked, 5 found, 10 not found, 5 errors
[AUTO-CHECK] üë§ Processing user 456 with 15 accounts...
[AUTO-CHECK] üßµ User 456 check complete: 15 checked, 3 found, 8 not found, 4 errors
[AUTO-CHECK] üë§ Processing user 789 with 15 accounts...
[AUTO-CHECK] üßµ User 789 check complete: 15 checked, 2 found, 10 not found, 3 errors
[AUTO-CHECK] üìä Final results: 50 checked, 10 found, 28 not found, 12 errors
```

## üöÄ –†–µ–∑—É–ª—å—Ç–∞—Ç

- ‚úÖ **–û–¥–∏–Ω –ø–æ—Ç–æ–∫**: –í—Å–µ –∞–≤—Ç–æ–ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ –æ–¥–Ω–æ–º –≤—Ç–æ—Ä–∏—á–Ω–æ–º –ø–æ—Ç–æ–∫–µ
- ‚úÖ **–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –æ–¥–∏–Ω –∑–∞ –¥—Ä—É–≥–∏–º
- ‚úÖ **–ü—Ä–æ—Å—Ç–æ—Ç–∞**: –£–±—Ä–∞–Ω–∞ —Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
- ‚úÖ **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å**: –ë–æ–ª–µ–µ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
- ‚úÖ **–û—Ç–ª–∞–¥–∫–∞**: –õ–µ–≥—á–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∏ –∏—Å–ø—Ä–∞–≤–ª—è—Ç—å –ø—Ä–æ–±–ª–µ–º—ã

**–°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –æ–¥–Ω–æ–º –ø–æ—Ç–æ–∫–µ —Å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π!** üéâ
