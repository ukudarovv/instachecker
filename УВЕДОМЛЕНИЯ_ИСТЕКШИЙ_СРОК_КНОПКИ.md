# ะฃะฒะตะดะพะผะปะตะฝะธั ะพะฑ ะธััะตะบัะตะผ ััะพะบะต ั ะบะฝะพะฟะบะฐะผะธ

## ะงัะพ ะธะทะผะตะฝะธะปะพัั

ะฃะฒะตะดะพะผะปะตะฝะธั ะพะฑ ะธััะตะบัะตะผ ััะพะบะต ะผะพะฝะธัะพัะธะฝะณะฐ ัะตะฟะตัั ัะฐะบะถะต ัะพะดะตัะถะฐั ะธะฝัะตัะฐะบัะธะฒะฝัะต ะบะฝะพะฟะบะธ ะดะปั ะฑััััะพะณะพ ัะฟัะฐะฒะปะตะฝะธั ะฐะบะบะฐัะฝัะฐะผะธ.

## ะะพะฒะฐั ััะฝะบัะธะพะฝะฐะปัะฝะพััั

### 1. ะฃะฒะตะดะพะผะปะตะฝะธะต ะพะฑ ะธััะตะบัะตะผ ััะพะบะต ั ะบะฝะพะฟะบะฐะผะธ

ะะผะตััะพ ัะตะบััะพะฒะพะณะพ ัะฟะธัะบะฐ ะฟัะพััะพัะตะฝะฝัั ะฐะบะบะฐัะฝัะพะฒ, ะฟะพะปัะทะพะฒะฐัะตะปั ะฟะพะปััะฐะตั ัะพะพะฑัะตะฝะธะต ั ะบะฝะพะฟะบะฐะผะธ:

```
โ๏ธ ะะะะะะะะ: ะััะตะบ ััะพะบ ะผะพะฝะธัะพัะธะฝะณะฐ!

๐ ะะฐะนะดะตะฝะพ ะฐะบะบะฐัะฝัะพะฒ: 3

๐ ะงัะพ ะดะตะปะฐัั:
1๏ธโฃ ะฃะฒะตะปะธัะธัั ะฟะตัะธะพะด ะผะพะฝะธัะพัะธะฝะณะฐ
2๏ธโฃ ะฃะดะฐะปะธัั ะฐะบะบะฐัะฝั ะธะท ัะฟะธัะบะฐ

๐ ะะฐะถะผะธัะต ะฝะฐ ะบะฝะพะฟะบั ั ะฐะบะบะฐัะฝัะพะผ ะดะปั ัะฟัะฐะฒะปะตะฝะธั:

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ @peshkova_expert (ะฟัะพััะพัะตะฝ ะฝะฐ 305 ะดะฝ.) โ  โ ะะะะะะ!
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ @negastudio (ะฟัะพััะพัะตะฝ ะฝะฐ 135 ะดะฝ.)      โ  โ ะะะะะะ!
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ @agathavegaofcc (ะฟัะพััะพัะตะฝ ะฝะฐ 74 ะดะฝ.)   โ  โ ะะะะะะ!
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ ๐ฑ ะะตะฐะบัะธะฒะฝัะต ะฐะบะบะฐัะฝัั           โ  โ ะะะะะะ!
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### 2. ะะฝัะพัะผะฐัะธั ะฟัะธ ะฝะฐะถะฐัะธะธ ะฝะฐ ะบะฝะพะฟะบั

ะัะธ ะฝะฐะถะฐัะธะธ ะฝะฐ ะบะฝะพะฟะบั ั ะฟัะพััะพัะตะฝะฝัะผ ะฐะบะบะฐัะฝัะพะผ ะพัะบััะฒะฐะตััั **ััะฐะฝะดะฐััะฝะฐั ะบะฐััะพัะบะฐ ะฐะบะบะฐัะฝัะฐ**:

```
๐ค ะะบะบะฐัะฝั
โข username: @peshkova_expert
โข ั: 2025-01-15
โข ะฟะตัะธะพะด (ะดะฝะตะน): 30
โข ะดะพ: 2025-02-14
โข ะพััะฐะปะพัั: -305
โข ััะฐััั: ๐ ะะฐ ะฟัะพะฒะตัะบะต / ะ ัะฐะฑะพัะต

โโโโโโโโโโโฌโโโโโโโโโโโ
โ โ ะะตะฝั โ โ ะะตะฝั โ  โ ะะะะะะ ะดะตะนััะฒะธะน
โโโโโโโโโโโดโโโโโโโโโโโค
โ    ๐ ะฃะดะฐะปะธัั       โ  โ ะะะะะะ ัะดะฐะปะตะฝะธั
โโโโโโโโโโโโโโโโโโโโโโค
โ     โฌ ะะฐะทะฐะด        โ  โ ะะะะะะ ะฝะฐะทะฐะด
โโโโโโโโโโโโโโโโโโโโโโ
```

### 3. ะะตะนััะฒะธั ั ะฟัะพััะพัะตะฝะฝัะผะธ ะฐะบะบะฐัะฝัะฐะผะธ

ะััะผะพ ะธะท ัะฒะตะดะพะผะปะตะฝะธั ะผะพะถะฝะพ:
- โ **ะัะพะดะปะธัั ะฟะตัะธะพะด** (ะบะฝะพะฟะบะฐ "โ ะะตะฝั")
- โ **ะกะพะบัะฐัะธัั ะฟะตัะธะพะด** (ะบะฝะพะฟะบะฐ "โ ะะตะฝั") 
- โ **ะฃะดะฐะปะธัั ะฐะบะบะฐัะฝั** (ะบะฝะพะฟะบะฐ "๐ ะฃะดะฐะปะธัั")
- โ **ะะพัะผะพััะตัั ะฒัะต ะฝะตะฐะบัะธะฒะฝัะต** (ะบะฝะพะฟะบะฐ "๐ฑ ะะตะฐะบัะธะฒะฝัะต ะฐะบะบะฐัะฝัั")

## ะกัะฐะฒะฝะตะฝะธะต: ะะพ ะธ ะะพัะปะต

### โ ะัะปะพ (ัะตะบััะพะฒะพะต ัะฒะตะดะพะผะปะตะฝะธะต):
```
โ๏ธ ะะะะะะะะ: ะััะตะบ ััะพะบ ะผะพะฝะธัะพัะธะฝะณะฐ!

๐ ะกะปะตะดัััะธะต ะฐะบะบะฐัะฝัั ะดะพััะธะณะปะธ ะบะพะฝัะฐ ะฟะตัะธะพะดะฐ ะผะพะฝะธัะพัะธะฝะณะฐ:
โข @peshkova_expert (ะฟัะพััะพัะตะฝ ะฝะฐ 305 ะดะฝ.)
โข @negastudio (ะฟัะพััะพัะตะฝ ะฝะฐ 135 ะดะฝ.)
โข @agathavegaofcc (ะฟัะพััะพัะตะฝ ะฝะฐ 74 ะดะฝ.)

๐ ะงัะพ ะดะตะปะฐัั:
1๏ธโฃ ะฃะฒะตะปะธัะธัั ะฟะตัะธะพะด ะผะพะฝะธัะพัะธะฝะณะฐ
2๏ธโฃ ะฃะดะฐะปะธัั ะฐะบะบะฐัะฝั ะธะท ัะฟะธัะบะฐ

๐ฑ ะัะฟะพะปัะทัะนัะต ะบะฝะพะฟะบั 'ะะตะฐะบัะธะฒะฝัะต ะฐะบะบะฐัะฝัั' ะดะปั ัะฟัะฐะฒะปะตะฝะธั
```

### โ ะกัะฐะปะพ (ะธะฝัะตัะฐะบัะธะฒะฝะพะต ัะฒะตะดะพะผะปะตะฝะธะต):
```
โ๏ธ ะะะะะะะะ: ะััะตะบ ััะพะบ ะผะพะฝะธัะพัะธะฝะณะฐ!

๐ ะะฐะนะดะตะฝะพ ะฐะบะบะฐัะฝัะพะฒ: 3

๐ ะงัะพ ะดะตะปะฐัั:
1๏ธโฃ ะฃะฒะตะปะธัะธัั ะฟะตัะธะพะด ะผะพะฝะธัะพัะธะฝะณะฐ
2๏ธโฃ ะฃะดะฐะปะธัั ะฐะบะบะฐัะฝั ะธะท ัะฟะธัะบะฐ

๐ ะะฐะถะผะธัะต ะฝะฐ ะบะฝะพะฟะบั ั ะฐะบะบะฐัะฝัะพะผ ะดะปั ัะฟัะฐะฒะปะตะฝะธั:

[๐ @peshkova_expert (ะฟัะพััะพัะตะฝ ะฝะฐ 305 ะดะฝ.)]
[๐ @negastudio (ะฟัะพััะพัะตะฝ ะฝะฐ 135 ะดะฝ.)]
[๐ @agathavegaofcc (ะฟัะพััะพัะตะฝ ะฝะฐ 74 ะดะฝ.)]
[๐ฑ ะะตะฐะบัะธะฒะฝัะต ะฐะบะบะฐัะฝัั]
```

## ะขะตัะฝะธัะตัะบะธะต ะดะตัะฐะปะธ

### ะะทะผะตะฝัะฝะฝัะต ัะฐะนะปั

#### 1. `project/services/expiry_notifications.py`

**ะคัะฝะบัะธั `send_expired_notification`**:
- ะกะพะทะดะฐัั ะธะฝัะตัะฐะบัะธะฒะฝัั ะบะปะฐะฒะธะฐัััั ะฒะผะตััะพ ัะตะบััะพะฒะพะณะพ ัะฟะธัะบะฐ
- ะะฐะถะดัะน ะฟัะพััะพัะตะฝะฝัะน ะฐะบะบะฐัะฝั = ะพัะดะตะปัะฝะฐั ะบะฝะพะฟะบะฐ ั callback
- ะคะพัะผะฐั callback: `expiry_expired:{account_id}`

```python
async def send_expired_notification(bot, user: User, accounts: List[Account]):
    # Header message
    message_lines = [
        "โ๏ธ <b>ะะะะะะะะ: ะััะตะบ ััะพะบ ะผะพะฝะธัะพัะธะฝะณะฐ!</b>\n",
        f"๐ ะะฐะนะดะตะฝะพ ะฐะบะบะฐัะฝัะพะฒ: {len(accounts)}\n",
        "๐ <b>ะงัะพ ะดะตะปะฐัั:</b>\n",
        "1๏ธโฃ ะฃะฒะตะปะธัะธัั ะฟะตัะธะพะด ะผะพะฝะธัะพัะธะฝะณะฐ\n",
        "2๏ธโฃ ะฃะดะฐะปะธัั ะฐะบะบะฐัะฝั ะธะท ัะฟะธัะบะฐ\n",
        "๐ ะะฐะถะผะธัะต ะฝะฐ ะบะฝะพะฟะบั ั ะฐะบะบะฐัะฝัะพะผ ะดะปั ัะฟัะฐะฒะปะตะฝะธั:"
    ]
    
    # Create inline keyboard with buttons for each account
    keyboard = []
    for acc in accounts:
        days_overdue = (date.today() - acc.to_date).days
        button_text = f"@{acc.account} (ะฟัะพััะพัะตะฝ ะฝะฐ {days_overdue} ะดะฝ.)"
        keyboard.append([{
            "text": button_text,
            "callback_data": f"expiry_expired:{acc.id}"
        }])
    
    # Add "Manage accounts" button
    keyboard.append([{
        "text": "๐ฑ ะะตะฐะบัะธะฒะฝัะต ะฐะบะบะฐัะฝัั",
        "callback_data": "show_inactive_accounts"
    }])
    
    reply_markup = {"inline_keyboard": keyboard}
    await bot.send_message(user.id, message, reply_markup=reply_markup)
```

#### 2. `project/bot.py`

**ะะฑะฝะพะฒะปัะฝ ะพะฑัะฐะฑะพััะธะบ callback**:

```python
elif callback_data.startswith("expiry_soon:") or callback_data.startswith("expiry_expired:"):
    # Show account info from expiry notification (both types)
    acc_id = int(callback_data.split(":")[1])
    
    # Same logic for both expiring soon and expired accounts
    # Shows account card with action buttons
```

## Callback ััะตะผะฐ

```
ะฃะฒะตะดะพะผะปะตะฝะธะต ะพะฑ ะธััะตะบัะตะผ ััะพะบะต
    โโ expiry_expired:{acc_id} โ ะะฐััะพัะบะฐ ะฐะบะบะฐัะฝัะฐ
    โ   โโ addd:{acc_id} โ ะะพะฑะฐะฒะธัั ะดะฝะธ (FSM)
    โ   โโ subd:{acc_id} โ ะฃะฑัะฐัั ะดะฝะธ (FSM)
    โ   โโ delc:{acc_id} โ ะฃะดะฐะปะธัั (ะฟะพะดัะฒะตัะถะดะตะฝะธะต)
    โ   โโ close_expiry_info โ ะะฐะบัััั/ะฃะดะฐะปะธัั
    โ
    โโ show_inactive_accounts โ ะกะฟะธัะพะบ ะฝะตะฐะบัะธะฒะฝัั
        โโ iinfo:{acc_id} โ ะะฐััะพัะบะฐ ะฐะบะบะฐัะฝัะฐ ะธะท ัะฟะธัะบะฐ
```

## ะัะธะผะตัั ะธัะฟะพะปัะทะพะฒะฐะฝะธั

### ะัะธะผะตั 1: ะัะพะดะปะตะฝะธะต ะฟัะพััะพัะตะฝะฝะพะณะพ ะฐะบะบะฐัะฝัะฐ

1. ะะพะปััะธะปะธ ัะฒะตะดะพะผะปะตะฝะธะต ะพ ะฟัะพััะพัะตะฝะฝัั ะฐะบะบะฐัะฝัะฐั
2. ะะฐะถะฐะปะธ ะฝะฐ `@peshkova_expert (ะฟัะพััะพัะตะฝ ะฝะฐ 305 ะดะฝ.)`
3. ะฃะฒะธะดะตะปะธ ะบะฐััะพัะบั ะฐะบะบะฐัะฝัะฐ
4. ะะฐะถะฐะปะธ `โ ะะตะฝั`
5. ะะฒะตะปะธ: `30`
6. ะะตัะธะพะด ะฟัะพะดะปัะฝ! โ

### ะัะธะผะตั 2: ะฃะดะฐะปะตะฝะธะต ะฟัะพััะพัะตะฝะฝะพะณะพ ะฐะบะบะฐัะฝัะฐ

1. ะะฐะถะฐะปะธ ะฝะฐ ะบะฝะพะฟะบั ั ะฟัะพััะพัะตะฝะฝัะผ ะฐะบะบะฐัะฝัะพะผ
2. ะะฐะถะฐะปะธ `๐ ะฃะดะฐะปะธัั`
3. ะะพะดัะฒะตัะดะธะปะธ ัะดะฐะปะตะฝะธะต
4. ะะบะบะฐัะฝั ัะดะฐะปัะฝ! โ

### ะัะธะผะตั 3: ะัะพัะผะพัั ะฒัะตั ะฝะตะฐะบัะธะฒะฝัั

1. ะะฐะถะฐะปะธ `๐ฑ ะะตะฐะบัะธะฒะฝัะต ะฐะบะบะฐัะฝัั`
2. ะฃะฒะธะดะตะปะธ ัะฟะธัะพะบ ะฒัะตั ะฝะตะฐะบัะธะฒะฝัั ะฐะบะบะฐัะฝัะพะฒ
3. ะะพะถะฝะพ ะฟะตัะตะปะธัััะฒะฐัั ัััะฐะฝะธัั

## ะขะธะฟั ัะฒะตะดะพะผะปะตะฝะธะน

### 1. ะัะตะดัะฟัะตะถะดะตะฝะธะต (ะทะฐ 7 ะดะฝะตะน) - ั ะบะฝะพะฟะบะฐะผะธ
```
โฐ ะะฐะฟะพะผะธะฝะฐะฝะธะต: ัะบะพัะพ ะธััะตัะตั ััะพะบ ะผะพะฝะธัะพัะธะฝะณะฐ

๐ ะะฐะนะดะตะฝะพ ะฐะบะบะฐัะฝัะพะฒ: 2

๐ก ะะตะบะพะผะตะฝะดะฐัะธั: ะฃะฒะตะปะธัััะต ะฟะตัะธะพะด ะผะพะฝะธัะพัะธะฝะณะฐ ะทะฐัะฐะฝะตะต

๐ ะะฐะถะผะธัะต ะฝะฐ ะบะฝะพะฟะบั ั ะฐะบะบะฐัะฝัะพะผ ะดะปั ะฟัะพัะผะพััะฐ ะธะฝัะพัะผะฐัะธะธ:

[๐ @username1 (ะพััะฐะปะพัั 5 ะดะฝ.)]
[๐ @username2 (ะพััะฐะปะพัั 3 ะดะฝ.)]
[๐ฑ ะะตะฐะบัะธะฒะฝัะต ะฐะบะบะฐัะฝัั]
```

### 2. ะัััะบ ััะพะบ - ั ะบะฝะพะฟะบะฐะผะธ
```
โ๏ธ ะะะะะะะะ: ะััะตะบ ััะพะบ ะผะพะฝะธัะพัะธะฝะณะฐ!

๐ ะะฐะนะดะตะฝะพ ะฐะบะบะฐัะฝัะพะฒ: 3

๐ ะงัะพ ะดะตะปะฐัั:
1๏ธโฃ ะฃะฒะตะปะธัะธัั ะฟะตัะธะพะด ะผะพะฝะธัะพัะธะฝะณะฐ
2๏ธโฃ ะฃะดะฐะปะธัั ะฐะบะบะฐัะฝั ะธะท ัะฟะธัะบะฐ

๐ ะะฐะถะผะธัะต ะฝะฐ ะบะฝะพะฟะบั ั ะฐะบะบะฐัะฝัะพะผ ะดะปั ัะฟัะฐะฒะปะตะฝะธั:

[๐ @username1 (ะฟัะพััะพัะตะฝ ะฝะฐ 5 ะดะฝ.)]
[๐ @username2 (ะฟัะพััะพัะตะฝ ะฝะฐ 10 ะดะฝ.)]
[๐ @username3 (ะฟัะพััะพัะตะฝ ะฝะฐ 27 ะดะฝ.)]
[๐ฑ ะะตะฐะบัะธะฒะฝัะต ะฐะบะบะฐัะฝัั]
```

## ะัะตะธะผััะตััะฒะฐ

โ **ะฃะดะพะฑััะฒะพ**: ะัั ะธะฝัะพัะผะฐัะธั ะฒ ะพะดะฝะพะผ ัะพะพะฑัะตะฝะธะธ  
โ **ะััััะพัะฐ**: ะะต ะฝัะถะฝะพ ะธัะบะฐัั ะฐะบะบะฐัะฝัั ะฒ ะผะตะฝั  
โ **ะะฐะณะปัะดะฝะพััั**: ะะธะดะฝะพ ะบะพะปะธัะตััะฒะพ ะฟัะพััะพัะตะฝะฝัั ะดะฝะตะน  
โ **ะะตะนััะฒะธั**: ะะพะถะฝะพ ััะฐะทั ะฟัะพะดะปะธัั ะธะปะธ ัะดะฐะปะธัั  
โ **UX**: ะกะพะฒัะตะผะตะฝะฝัะน ะธะฝัะตััะตะนั ั inline ะบะฝะพะฟะบะฐะผะธ  
โ **ะะดะธะฝะพะพะฑัะฐะทะธะต**: ะะดะธะฝะฐะบะพะฒัะน ะธะฝัะตััะตะนั ะดะปั ะฒัะตั ัะฒะตะดะพะผะปะตะฝะธะน  

## ะะฑัะฐัะฝะฐั ัะพะฒะผะตััะธะผะพััั

โ ะัะต ัััะตััะฒัััะธะต callback ะพะฑัะฐะฑะพััะธะบะธ ัะฐะฑะพัะฐัั ะฑะตะท ะธะทะผะตะฝะตะฝะธะน  
โ ะกัะฐะฝะดะฐััะฝัะต ะผะตะฝั ะฑะพัะฐ ะฝะต ะทะฐััะพะฝััั  
โ ะะพะณะธะบะฐ ัะฒะตะดะพะผะปะตะฝะธะน ัะพััะฐะฝะตะฝะฐ, ะดะพะฑะฐะฒะปะตะฝะฐ ัะพะปัะบะพ ะธะฝัะตัะฐะบัะธะฒะฝะพััั  

## ะขะตััะธัะพะฒะฐะฝะธะต

ะะปั ัะตััะธัะพะฒะฐะฝะธั ะธัะฟะพะปัะทัะนัะต:

```bash
# ะขะตัั ัะฒะตะดะพะผะปะตะฝะธะน ะพ ัะบะพัะพะผ ะธััะตัะตะฝะธะธ (ะทะฐ 7 ะดะฝะตะน)
python test_send_to_me.py

# ะขะตัั ัะฒะตะดะพะผะปะตะฝะธะน ะพะฑ ะธััะตะบัะตะผ ััะพะบะต
python test_expired_notification.py

# ะขะตัั ะฒัะตั ัะฒะตะดะพะผะปะตะฝะธะน
python test_expiry_notification.py
```

## ะะฐัะฐ ะพะฑะฝะพะฒะปะตะฝะธั

16 ะพะบััะฑัั 2025

