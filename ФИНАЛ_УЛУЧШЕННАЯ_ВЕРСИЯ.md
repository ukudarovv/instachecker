# üéâ –§–ò–ù–ê–õ: –£–ª—É—á—à–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ —Å–æ–≥–ª–∞—Å–Ω–æ –≤–∞—à–µ–º—É prompt –Ω–∞ 100%

### üéØ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∏–∑ prompt:

#### 1. –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ Instagram ‚úÖ
- [x] `emulate_media(color_scheme='dark')`
- [x] JavaScript injection –¥–ª—è localStorage
- [x] Device preferences —Å `color_scheme: 'dark'`
- [x] Browser flags (`--force-dark-mode`)
- [x] CSS injection —á–µ—Ä–µ–∑ `_apply_dark_theme`
- [x] –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ JavaScript

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 6 —É—Ä–æ–≤–Ω–µ–π –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã!

#### 2. –¢–æ–ª—å–∫–æ –æ–±–ª–∞—Å—Ç—å header ‚úÖ
- [x] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–µ–∑–∫–∞
- [x] –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π `crop_ratio`
- [x] –ö–∞—á–µ—Å—Ç–≤–æ PNG (quality=95)
- [x] –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞–∑–º–µ—Ä–∞—Ö

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –¢–æ—á–Ω–∞—è –æ–±—Ä–µ–∑–∫–∞ –¥–æ header'–∞!

#### 3. –ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è ‚úÖ
- [x] –≠–º—É–ª—è—Ü–∏—è iPhone 12
- [x] –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π viewport (390x844)
- [x] –ú–æ–±–∏–ª—å–Ω—ã–π User-Agent
- [x] Touch support

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ò–¥–µ–∞–ª—å–Ω–∞—è –º–æ–±–∏–ª—å–Ω–∞—è —ç–º—É–ª—è—Ü–∏—è!

#### 4. –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ ‚úÖ
- [x] PNG —Ñ–æ—Ä–º–∞—Ç
- [x] Quality 95%
- [x] –•–æ—Ä–æ—à–µ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ
- [x] –ë–µ–∑ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –û—Ç–ª–∏—á–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤!

---

## üìä –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –§—É–Ω–∫—Ü–∏—è: `check_account_with_header_screenshot`

**–ù–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```python
mobile_emulation: bool = True  # iPhone 12 —ç–º—É–ª—è—Ü–∏—è
crop_ratio: float = 0.25  # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–∞—è –æ–±—Ä–µ–∑–∫–∞
```

**–ù–æ–≤—ã–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –ø–æ–ª—è:**
```python
{
    "dark_theme_applied": bool,  # –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã
    "mobile_emulation": bool,  # –°—Ç–∞—Ç—É—Å –º–æ–±–∏–ª—å–Ω–æ–π —ç–º—É–ª—è—Ü–∏–∏
    "cropped": bool,  # –°—Ç–∞—Ç—É—Å –æ–±—Ä–µ–∑–∫–∏
    "original_size": "390x844",  # –ò—Å—Ö–æ–¥–Ω—ã–π —Ä–∞–∑–º–µ—Ä
    "final_size": "390x211"  # –§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä
}
```

### –£—Ä–æ–≤–Ω–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã:

1. **Browser Level**
   ```python
   "--force-dark-mode"
   "--enable-features=WebUIDarkMode"
   ```

2. **Context Level**
   ```python
   context_options["color_scheme"] = "dark"
   ```

3. **JavaScript Injection**
   ```python
   localStorage.setItem('dark_mode', '1')
   localStorage.setItem('ig_dark_mode', '1')
   localStorage.setItem('theme', 'dark')
   ```

4. **matchMedia Override**
   ```python
   Object.defineProperty(window, 'matchMedia', {
       value: (query) => ({
           matches: query.includes('dark') ? true : false,
           ...
       })
   })
   ```

5. **Media Emulation**
   ```python
   await page.emulate_media(color_scheme='dark')
   ```

6. **CSS Injection**
   ```python
   await _apply_dark_theme(page)
   ```

7. **Verification**
   ```python
   dark_theme_verified = await page.evaluate(...)
   ```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –§–∞–π–ª—ã:

1. **test_header_dark_fixed.py** - –£–ª—É—á—à–µ–Ω–Ω—ã–π —Ç–µ—Å—Ç
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –Ω–æ–≤—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
   - –î–µ—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã (5 —Ç–æ—á–µ–∫)
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–æ–≤ –∏ –æ–±—Ä–µ–∑–∫–∏

### –ó–∞–ø—É—Å–∫:

```bash
python test_header_dark_fixed.py
```

### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

```
üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –£–õ–£–ß–®–ï–ù–ù–û–ì–û –¢–ï–°–¢–ê
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
‚úÖ –£—Å–ø–µ—Ö: True
üìù Checked via: proxy_header_screenshot
üåô –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞: True
üì± –ú–æ–±–∏–ª—å–Ω–∞—è —ç–º—É–ª—è—Ü–∏—è: True
‚úÇÔ∏è  –û–±—Ä–µ–∑–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞: True
üìè –†–∞–∑–º–µ—Ä: 390x844 ‚Üí 390x211
üì∏ –°–∫—Ä–∏–Ω—à–æ—Ç: screenshots/test_header_dark_FIXED_instagram.png

üé® –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–≤–µ—Ç–∞ —Ñ–æ–Ω–∞ –≤ 5 —Ç–æ—á–∫–∞—Ö:
   –¢–æ—á–∫–∞ 1: RGB(  0,  0,  0) —è—Ä–∫–æ—Å—Ç—å=  0 üåô –¢–ï–ú–ù–´–ô
   –¢–æ—á–∫–∞ 2: RGB(  0,  0,  0) —è—Ä–∫–æ—Å—Ç—å=  0 üåô –¢–ï–ú–ù–´–ô
   –¢–æ—á–∫–∞ 3: RGB(  0,  0,  0) —è—Ä–∫–æ—Å—Ç—å=  0 üåô –¢–ï–ú–ù–´–ô
   –¢–æ—á–∫–∞ 4: RGB(  0,  0,  0) —è—Ä–∫–æ—Å—Ç—å=  0 üåô –¢–ï–ú–ù–´–ô
   –¢–æ—á–∫–∞ 5: RGB(  0,  0,  0) —è—Ä–∫–æ—Å—Ç—å=  0 üåô –¢–ï–ú–ù–´–ô
üìä –¢–µ–º–Ω—ã—Ö –ø–∏–∫—Å–µ–ª–µ–π: 5/5 (100%)

‚úÖ –£–°–ü–ï–•: –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ (–±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –ø–∏–∫—Å–µ–ª–µ–π —Ç–µ–º–Ω—ã–µ)
‚úÖ –£–°–ü–ï–•: –°–∫—Ä–∏–Ω—à–æ—Ç header'–∞ (–≤—ã—Å–æ—Ç–∞ 211px)
```

---

## üìÇ –§–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞

### –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥:
- `project/services/ig_screenshot.py` - –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
- `test_header_dark_fixed.py` - –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- `–ù–ê–ß–ù–ò–¢–ï_–û–¢–°–Æ–î–ê_–£–õ–£–ß–®–ï–ù–ù–ê–Ø_–í–ï–†–°–ò–Ø.md` - **–ì–õ–ê–í–ù–´–ô –§–ê–ô–õ** üåü
- `–£–õ–£–ß–®–ï–ù–ò–Ø_–¢–ï–ú–ù–ê–Ø_–¢–ï–ú–ê_–ú–û–ë–ò–õ–¨–ù–ê–Ø.md` - –î–µ—Ç–∞–ª–∏ —É–ª—É—á—à–µ–Ω–∏–π
- `–ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø_HEADER_–¢–ï–ú–ù–ê–Ø_–¢–ï–ú–ê.md` - –ò—Å—Ç–æ—Ä–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
- `–§–ò–ù–ê–õ_–£–õ–£–ß–®–ï–ù–ù–ê–Ø_–í–ï–†–°–ò–Ø.md` - –≠—Ç–æ—Ç —Ñ–∞–π–ª

---

## üéØ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | –ë—ã–ª–æ | –°—Ç–∞–ª–æ |
|----------------|------|-------|
| –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ | 1 —É—Ä–æ–≤–µ–Ω—å | **6 —É—Ä–æ–≤–Ω–µ–π** ‚úÖ |
| –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç–µ–º—ã | –ù–µ—Ç | **–ï—Å—Ç—å** ‚úÖ |
| –ú–æ–±–∏–ª—å–Ω–∞—è —ç–º—É–ª—è—Ü–∏—è | –ù–µ—Ç | **iPhone 12** ‚úÖ |
| –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–µ–∑–∫–∏ | –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è | **–ì–∏–±–∫–∞—è (crop_ratio)** ‚úÖ |
| –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è | –ë–∞–∑–æ–≤–∞—è | **–î–µ—Ç–∞–ª—å–Ω–∞—è** ‚úÖ |
| –†–∞–∑–º–µ—Ä (mobile) | –ù–µ—Ç | **390x211 px** ‚úÖ |
| –ö–∞—á–µ—Å—Ç–≤–æ | 75% | **95%** ‚úÖ |

---

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∫–æ–¥:

```python
from project.services.ig_screenshot import check_account_with_header_screenshot

result = await check_account_with_header_screenshot(
    username="instagram",
    proxy_url="http://proxy:8080"
)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- üì± iPhone 12 (390x844)
- üåô –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ (6 —É—Ä–æ–≤–Ω–µ–π)
- ‚úÇÔ∏è –û–±—Ä–µ–∑–∫–∞ –¥–æ header'–∞ (25%)
- üì∏ PNG –∫–∞—á–µ—Å—Ç–≤–æ 95%

---

## ‚úÖ Checklist —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ò–∑ –≤–∞—à–µ–≥–æ prompt:

‚úÖ **–¢–µ–º–Ω–∞—è —Ç–µ–º–∞ Instagram** - DONE (6 —É—Ä–æ–≤–Ω–µ–π)  
‚úÖ **–¢–æ–ª—å–∫–æ header –ø—Ä–æ—Ñ–∏–ª—è** - DONE (crop_ratio)  
‚úÖ **–ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è** - DONE (iPhone 12)  
‚úÖ **–í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ** - DONE (PNG, 95%)  
‚úÖ **emulate_media** - DONE  
‚úÖ **JavaScript injection** - DONE  
‚úÖ **Device preferences** - DONE  
‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–µ–∑–∫–∞** - DONE  
‚úÖ **–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è** - DONE  
‚úÖ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - DONE  

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ (bonus):

‚úÖ **–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–∞—è –æ–±—Ä–µ–∑–∫–∞** - crop_ratio  
‚úÖ **–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è** - —Ä–∞–∑–º–µ—Ä—ã, —Å—Ç–∞—Ç—É—Å—ã  
‚úÖ **–£–ª—É—á—à–µ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - 5-—Ç–æ—á–µ—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞  
‚úÖ **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** - –ø–æ–¥—Ä–æ–±–Ω–∞—è  

---

## üéâ –ò–¢–û–ì

**–í—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∏–∑ –≤–∞—à–µ–≥–æ –ø–æ–¥—Ä–æ–±–Ω–æ–≥–æ prompt –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –Ω–∞ 100%!**

### –ß—Ç–æ –ø–æ–ª—É—á–∏–ª–æ—Å—å:

1. ‚úÖ **–¢–µ–º–Ω–∞—è —Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç** (6 —É—Ä–æ–≤–Ω–µ–π –∑–∞—â–∏—Ç—ã)
2. ‚úÖ **–û–±—Ä–µ–∑–∫–∞ –¥–æ header'–∞** (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–∞—è)
3. ‚úÖ **–ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è** (iPhone 12)
4. ‚úÖ **–í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ** (PNG 95%)
5. ‚úÖ **–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è** (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã)
6. ‚úÖ **–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è** (–≤—Å–µ —Å—Ç–∞—Ç—É—Å—ã)

### –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç:
python test_header_dark_fixed.py

# –†–µ–∑—É–ª—å—Ç–∞—Ç:
# ‚úÖ –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞
# ‚úÖ –ú–æ–±–∏–ª—å–Ω–∞—è —ç–º—É–ª—è—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
# ‚úÖ –û–±—Ä–µ–∑–∫–∞ –¥–æ header'–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞
# ‚úÖ –°–∫—Ä–∏–Ω—à–æ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω
```

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ  
**Prompt –≤—ã–ø–æ–ª–Ω–µ–Ω:** 100%  
**–î–∞—Ç–∞:** 22 –æ–∫—Ç—è–±—Ä—è 2025  
**–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:** –î–∞! üéâ

