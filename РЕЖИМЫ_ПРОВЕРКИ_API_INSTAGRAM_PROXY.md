
# –†–µ–∂–∏–º—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–∫–∫–∞—É–Ω—Ç–æ–≤: API + Instagram / API + Proxy

## üéØ –¶–µ–ª—å

–î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É –¥–≤—É–º—è —Ä–µ–∂–∏–º–∞–º–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–∫–∫–∞—É–Ω—Ç–æ–≤:

1. **API + Instagram** - –î–≤—É—Ö—ç—Ç–∞–ø–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π –≤ Instagram
2. **API + Proxy** - –î–≤—É—Ö—ç—Ç–∞–ø–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ proxy –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

## üìã –†–µ–∂–∏–º—ã –ø—Ä–æ–≤–µ—Ä–∫–∏

### 1. **API + Instagram** (api+instagram)

**–≠—Ç–∞–ø 1**: –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ RapidAPI  
**–≠—Ç–∞–ø 2**: –ï—Å–ª–∏ –∞–∫–∫–∞—É–Ω—Ç –Ω–∞–π–¥–µ–Ω - –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ Instagram **—Å –ª–æ–≥–∏–Ω–æ–º**

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- ‚úÖ –¢–æ—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π (–ø–æ–¥–ø–∏—Å—á–∏–∫–∏, –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –∏ —Ç.–¥.)
- ‚úÖ –°–∫—Ä–∏–Ω—à–æ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–æ—Ñ–∏–ª—è
- ‚úÖ –î–æ—Å—Ç—É–ø –∫ –ø—Ä–∏–≤–∞—Ç–Ω—ã–º –ø—Ä–æ—Ñ–∏–ª—è–º (–µ—Å–ª–∏ –µ—Å—Ç—å –ø–æ–¥–ø–∏—Å–∫–∞)

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è**:
- Instagram —Å–µ—Å—Å–∏—è (cookies)
- –õ–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å –¥–ª—è –ø–µ—Ä–µ–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è**:
- `check_account_with_screenshot()` –∏–∑ `project/services/ig_simple_checker.py`

---

### 2. **API + Proxy** (api+proxy)

**–≠—Ç–∞–ø 1**: –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ RapidAPI  
**–≠—Ç–∞–ø 2**: –ï—Å–ª–∏ –∞–∫–∫–∞—É–Ω—Ç –Ω–∞–π–¥–µ–Ω - –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ proxy **–±–µ–∑ –ª–æ–≥–∏–Ω–∞**

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç Instagram –∞–∫–∫–∞—É–Ω—Ç–∞
- ‚úÖ –°–∫—Ä–∏–Ω—à–æ—Ç –ø—É–±–ª–∏—á–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- ‚úÖ –ü—Ä–æ—Å—Ç–æ—Ç–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è**:
- –ê–∫—Ç–∏–≤–Ω—ã–π proxy (–Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –≤ —Å–∏—Å—Ç–µ–º–µ)

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è**:
- `check_account_via_proxy_with_screenshot()` –∏–∑ `project/services/proxy_checker.py`

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### 1. –ú–æ–¥–µ–ª—å User

**–§–∞–π–ª**: `project/models.py`

–î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `verify_mode`:

```python
class User(Base):
    # ...
    verify_mode = Column(String, default="api+instagram", nullable=False)  
    # –ó–Ω–∞—á–µ–Ω–∏—è: 'api+instagram' | 'api+proxy'
```

---

### 2. Proxy Checker (–±–µ–∑ –ª–æ–≥–∏–Ω–∞)

**–§–∞–π–ª**: `project/services/proxy_checker.py`

–ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —á–µ—Ä–µ–∑ proxy –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:

```python
async def check_account_via_proxy(
    username: str,
    proxy: Optional[Proxy] = None,
    headless: bool = True,
    timeout_ms: int = 30000
) -> Dict[str, Any]:
    """
    Check if Instagram account exists using proxy without login.
    Just opens the public profile page.
    """
    # –û—Ç–∫—Ä—ã–≤–∞–µ—Ç https://www.instagram.com/{username}/
    # –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ/–æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞ –ø–æ —Ç–µ–∫—Å—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    # –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å –ø—Ä–æ—Ñ–∏–ª—è
```

**–õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è**:
- –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å —Ç–µ–∫—Å—Ç–æ–º "Sorry, this page isn't available" = –∞–∫–∫–∞—É–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω
- –¢–µ–∫—Å—Ç "This Account is Private" = –∞–∫–∫–∞—É–Ω—Ç –ø—Ä–∏–≤–∞—Ç–Ω—ã–π
- –ù–∞–ª–∏—á–∏–µ profile picture –∏–ª–∏ header = –∞–∫–∫–∞—É–Ω—Ç –ø—É–±–ª–∏—á–Ω—ã–π

---

### 3. Hybrid Checker

**–§–∞–π–ª**: `project/services/hybrid_checker.py`

–û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `check_account_hybrid`:

```python
async def check_account_hybrid(
    session: Session,
    user_id: int,
    username: str,
    ig_session: Optional[InstagramSession] = None,
    fernet: Optional[OptionalFernet] = None,
    skip_instagram_verification: bool = False,
    verify_mode: str = "api+instagram"  # –ù–û–í–´–ô –ü–ê–†–ê–ú–ï–¢–†
) -> Dict[str, Any]:
```

**–õ–æ–≥–∏–∫–∞**:

```python
# –®–∞–≥ 1: API –ø—Ä–æ–≤–µ—Ä–∫–∞ (–±—ã—Å—Ç—Ä–æ)
api_result = await check_account_exists_via_api(...)

# –®–∞–≥ 2: –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ - –≤—ã–±–∏—Ä–∞–µ–º –º–µ—Ç–æ–¥ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
if api_result["exists"] is True:
    if verify_mode == "api+instagram":
        # Instagram –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å –ª–æ–≥–∏–Ω–æ–º
        ig_result = await check_account_with_screenshot(...)
    elif verify_mode == "api+proxy":
        # Proxy –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑ –ª–æ–≥–∏–Ω–∞
        proxy_result = await check_account_via_proxy_with_screenshot(...)
```

---

### 4. Auto Checker

**–§–∞–π–ª**: `project/cron/auto_checker.py`

–û–±–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –∞–≤—Ç–æ–ø—Ä–æ–≤–µ—Ä–∫–∏:

```python
# –ü–æ–ª—É—á–∞–µ–º verify_mode –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
user = s.query(User).get(acc.user_id)
verify_mode = user.verify_mode or "api+instagram"

# –ü–æ–ª—É—á–∞–µ–º –Ω—É–∂–Ω—É—é —Å–µ—Å—Å–∏—é/proxy
if verify_mode == "api+instagram":
    ig_session = get_priority_valid_session(s, acc.user_id, fernet)
else:  # api+proxy
    ig_session = None  # Proxy –Ω–µ –Ω—É–∂–Ω–∞ IG —Å–µ—Å—Å–∏—è

# –ü–µ—Ä–µ–¥–∞–µ–º verify_mode –≤ –ø—Ä–æ–≤–µ—Ä–∫—É
result = await check_account_hybrid(
    session=s,
    user_id=acc.user_id,
    username=acc.account,
    ig_session=ig_session,
    fernet=fernet,
    verify_mode=verify_mode
)
```

**–õ–æ–≥–∏**:

```
[AUTO-CHECK] API check @username (mode: api+instagram)...
[AUTO-CHECK] ‚úì @username - API says ACTIVE (will verify with Instagram)
```

–∏–ª–∏

```
[AUTO-CHECK] API check @username (mode: api+proxy)...
[AUTO-CHECK] ‚úì @username - API says ACTIVE (will verify with Proxy)
```

---

### 5. –ê–¥–º–∏–Ω-–º–µ–Ω—é

**–§–∞–π–ª—ã**: 
- `project/keyboards.py` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞
- `project/handlers/user_management.py` - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏

**–ö–Ω–æ–ø–∫–∞ –≤ –∫–∞—Ä—Ç–æ—á–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**:
```
üîÑ –ò–∑–º–µ–Ω–∏—Ç—å —Ä–µ–∂–∏–º –ø—Ä–æ–≤–µ—Ä–∫–∏
```

**–ú–µ–Ω—é –≤—ã–±–æ—Ä–∞ —Ä–µ–∂–∏–º–∞**:
```
üîÑ –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: @username
–¢–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º: api+instagram

–í—ã–±–µ—Ä–∏—Ç–µ –Ω–æ–≤—ã–π —Ä–µ–∂–∏–º –ø—Ä–æ–≤–µ—Ä–∫–∏:

[üîë API + üì∏ Instagram (—Å –ª–æ–≥–∏–Ω–æ–º)]
[üîë API + üåê Proxy (–±–µ–∑ –ª–æ–≥–∏–Ω–∞)]
[‚¨Ö –ù–∞–∑–∞–¥]
```

**–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏**:
- `handle_callback_usr_change_verify` - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–µ–Ω—é –≤—ã–±–æ—Ä–∞
- `handle_callback_usr_set_verify` - —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤

| –ü–∞—Ä–∞–º–µ—Ç—Ä | API + Instagram | API + Proxy |
|----------|----------------|-------------|
| **–°–∫–æ—Ä–æ—Å—Ç—å API** | 1 —Å–µ–∫ | 1 —Å–µ–∫ |
| **–°–∫–æ—Ä–æ—Å—Ç—å –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏** | 5 —Å–µ–∫ | 5 —Å–µ–∫ |
| **–¢—Ä–µ–±—É–µ—Ç IG –∞–∫–∫–∞—É–Ω—Ç** | ‚úÖ –î–∞ | ‚ùå –ù–µ—Ç |
| **–¢—Ä–µ–±—É–µ—Ç Proxy** | ‚ùå –ù–µ—Ç | ‚úÖ –î–∞ |
| **–°–∫—Ä–∏–Ω—à–æ—Ç—ã** | ‚úÖ –î–∞ | ‚úÖ –î–∞ |
| **–ü–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ** | ‚úÖ –î–∞ | ‚ùå –ß–∞—Å—Ç–∏—á–Ω–æ |
| **–ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏** | ‚úÖ –î–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å –ø–æ–¥–ø–∏—Å–∫–∞) | ‚ùå –ù–µ—Ç |
| **–†–∏—Å–∫ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ IG** | –°—Ä–µ–¥–Ω–∏–π | –ù–∏–∑–∫–∏–π |

---

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è

**–§–∞–π–ª**: `migrate_verify_mode.py`

–û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è `verify_mode`:

```
'api' ‚Üí 'api+instagram'
'instagram' ‚Üí 'api+instagram'
'proxy' ‚Üí 'api+proxy'
NULL ‚Üí 'api+instagram'
```

**–ó–∞–ø—É—Å–∫**:
```bash
python migrate_verify_mode.py
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:
```
‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: 11
```

---

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å Instagram —Å–µ—Å—Å–∏–µ–π

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞**: `api+instagram`

```
[AUTO-CHECK] API check @username (mode: api+instagram)...
[AUTO-CHECK] ‚úì @username - API says ACTIVE (will verify with Instagram)
[AUTO-CHECK] Instagram verify @username...
‚úÖ Both API and Instagram confirm @username is active
üì∏ Screenshot saved: screenshots/ig_username_20251017_120000.png
```

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±–µ–∑ Instagram, –Ω–æ —Å Proxy

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞**: `api+proxy`

```
[AUTO-CHECK] API check @username (mode: api+proxy)...
[AUTO-CHECK] ‚úì @username - API says ACTIVE (will verify with Proxy)
[AUTO-CHECK] Proxy verify @username...
[PROXY-CHECK] Opening https://www.instagram.com/username/...
‚úÖ Both API and Proxy confirm @username is active
üì∏ Screenshot saved: screenshots/ig_username_20251017_120000.png
```

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –°–º–µ–Ω–∞ —Ä–µ–∂–∏–º–∞ –≤ –∞–¥–º–∏–Ω–∫–µ

1. –ê–¥–º–∏–Ω –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –∫–∞—Ä—Ç–æ—á–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. –ù–∞–∂–∏–º–∞–µ—Ç "üîÑ –ò–∑–º–µ–Ω–∏—Ç—å —Ä–µ–∂–∏–º –ø—Ä–æ–≤–µ—Ä–∫–∏"
3. –í–∏–¥–∏—Ç —Ç–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º: `api+instagram`
4. –í—ã–±–∏—Ä–∞–µ—Ç: "üîë API + üåê Proxy (–±–µ–∑ –ª–æ–≥–∏–Ω–∞)"
5. –ü–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: "‚úÖ –†–µ–∂–∏–º –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ üîë API + üåê Proxy"
6. –¢–µ–ø–µ—Ä—å –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–ª—è —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç proxy

---

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã

‚úÖ **–ì–∏–±–∫–æ—Å—Ç—å** - –∫–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç —É–¥–æ–±–Ω—ã–π —Ä–µ–∂–∏–º  
‚úÖ **API –≤—Å–µ–≥–¥–∞ –ø–µ—Ä–≤—ã–π** - –±—ã—Å—Ç—Ä–∞—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞  
‚úÖ **–ú–∏–Ω–∏–º—É–º –∑–∞–¥–µ—Ä–∂–µ–∫** - —Ç–æ–ª—å–∫–æ 1 —Å–µ–∫—É–Ω–¥–∞ –¥–ª—è API  
‚úÖ **Proxy –±–µ–∑ –ª–æ–≥–∏–Ω–∞** - –Ω–µ —Ç—Ä–µ–±—É–µ—Ç Instagram –∞–∫–∫–∞—É–Ω—Ç–∞  
‚úÖ **–ü—Ä–æ—Å—Ç–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ** - —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–º–µ–Ω—é  
‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è** - —Å—Ç–∞—Ä—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è  

---

## üöÄ –ò—Ç–æ–≥–æ

–°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–≤–∞ —Ä–µ–∂–∏–º–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:

1. **API + Instagram** - –¥–ª—è —Ç–æ—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å –ø–æ–ª–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
2. **API + Proxy** - –¥–ª—è –ø—Ä–æ—Å—Ç–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

**–í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å API** (–±—ã—Å—Ç—Ä–æ), –∑–∞—Ç–µ–º –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤—ã–±—Ä–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏!

**–î–∞—Ç–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**: 17 –æ–∫—Ç—è–±—Ä—è 2025

