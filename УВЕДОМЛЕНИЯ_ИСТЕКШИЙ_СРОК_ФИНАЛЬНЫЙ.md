# ะฃะฒะตะดะพะผะปะตะฝะธั ะพะฑ ะธััะตะบัะตะผ ััะพะบะต - ะคะธะฝะฐะปัะฝะฐั ะฒะตััะธั

## ะงัะพ ะธะทะผะตะฝะธะปะพัั

ะฃะฒะตะดะพะผะปะตะฝะธั ะพะฑ ะธััะตะบัะตะผ ััะพะบะต ะผะพะฝะธัะพัะธะฝะณะฐ ัะตะฟะตัั ัะพะดะตัะถะฐั **ะพัะธะณะธะฝะฐะปัะฝัะน ัะตะบัั** + **ะธะฝัะตัะฐะบัะธะฒะฝัะต ะบะฝะพะฟะบะธ** ะฟะพะด ัะพะพะฑัะตะฝะธะตะผ.

## ะะพะฒัะน ัะพัะผะฐั ัะฒะตะดะพะผะปะตะฝะธั

### โ ะคะธะฝะฐะปัะฝะฐั ะฒะตััะธั (ั ะบะฝะพะฟะบะฐะผะธ):

```
โ๏ธ ะะะะะะะะ: ะััะตะบ ััะพะบ ะผะพะฝะธัะพัะธะฝะณะฐ!

๐ ะกะปะตะดัััะธะต ะฐะบะบะฐัะฝัั ะดะพััะธะณะปะธ ะบะพะฝัะฐ ะฟะตัะธะพะดะฐ ะผะพะฝะธัะพัะธะฝะณะฐ:
โข @ukudarovvv (ะฟัะพััะพัะตะฝ ะฝะฐ 27 ะดะฝ.)
โข @peshkova_expert (ะฟัะพััะพัะตะฝ ะฝะฐ 305 ะดะฝ.)
โข @negastudio (ะฟัะพััะพัะตะฝ ะฝะฐ 135 ะดะฝ.)

๐ ะงัะพ ะดะตะปะฐัั:
1๏ธโฃ ะฃะฒะตะปะธัะธัั ะฟะตัะธะพะด ะผะพะฝะธัะพัะธะฝะณะฐ
2๏ธโฃ ะฃะดะฐะปะธัั ะฐะบะบะฐัะฝั ะธะท ัะฟะธัะบะฐ

๐ฑ ะัะฟะพะปัะทัะนัะต ะบะฝะพะฟะบั 'ะะตะฐะบัะธะฒะฝัะต ะฐะบะบะฐัะฝัั' ะดะปั ัะฟัะฐะฒะปะตะฝะธั

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ @ukudarovvv (ะฟัะพััะพัะตะฝ ะฝะฐ 27 ะดะฝ.) โ  โ ะะะะะะ!
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ @peshkova_expert (ะฟัะพััะพัะตะฝ ะฝะฐ 305 ะดะฝ.) โ  โ ะะะะะะ!
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ @negastudio (ะฟัะพััะพัะตะฝ ะฝะฐ 135 ะดะฝ.) โ  โ ะะะะะะ!
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ ๐ฑ ะะตะฐะบัะธะฒะฝัะต ะฐะบะบะฐัะฝัั           โ  โ ะะะะะะ!
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### โ ะัะปะพ (ัะพะปัะบะพ ัะตะบัั):
```
โ๏ธ ะะะะะะะะ: ะััะตะบ ััะพะบ ะผะพะฝะธัะพัะธะฝะณะฐ!

๐ ะกะปะตะดัััะธะต ะฐะบะบะฐัะฝัั ะดะพััะธะณะปะธ ะบะพะฝัะฐ ะฟะตัะธะพะดะฐ ะผะพะฝะธัะพัะธะฝะณะฐ:
โข @ukudarovvv (ะฟัะพััะพัะตะฝ ะฝะฐ 27 ะดะฝ.)

๐ ะงัะพ ะดะตะปะฐัั:
1๏ธโฃ ะฃะฒะตะปะธัะธัั ะฟะตัะธะพะด ะผะพะฝะธัะพัะธะฝะณะฐ
2๏ธโฃ ะฃะดะฐะปะธัั ะฐะบะบะฐัะฝั ะธะท ัะฟะธัะบะฐ

๐ฑ ะัะฟะพะปัะทัะนัะต ะบะฝะพะฟะบั 'ะะตะฐะบัะธะฒะฝัะต ะฐะบะบะฐัะฝัั' ะดะปั ัะฟัะฐะฒะปะตะฝะธั
```

## ะคัะฝะบัะธะพะฝะฐะปัะฝะพััั ะบะฝะพะฟะพะบ

### 1. **ะะฝะพะฟะบะธ ะฐะบะบะฐัะฝัะพะฒ**
- ะะฐะถะดัะน ะฟัะพััะพัะตะฝะฝัะน ะฐะบะบะฐัะฝั = ะพัะดะตะปัะฝะฐั ะบะฝะพะฟะบะฐ
- ะคะพัะผะฐั: `@username (ะฟัะพััะพัะตะฝ ะฝะฐ X ะดะฝ.)`
- ะัะธ ะฝะฐะถะฐัะธะธ โ ะพัะบััะฒะฐะตััั ะบะฐััะพัะบะฐ ะฐะบะบะฐัะฝัะฐ

### 2. **ะะฐััะพัะบะฐ ะฐะบะบะฐัะฝัะฐ ะฟัะธ ะฝะฐะถะฐัะธะธ**
```
๐ค ะะบะบะฐัะฝั
โข username: @ukudarovvv
โข ั: 2025-09-19
โข ะฟะตัะธะพะด (ะดะฝะตะน): 30
โข ะดะพ: 2025-10-19
โข ะพััะฐะปะพัั: -27
โข ััะฐััั: ๐ ะะฐ ะฟัะพะฒะตัะบะต / ะ ัะฐะฑะพัะต

โโโโโโโโโโโฌโโโโโโโโโโโ
โ โ ะะตะฝั โ โ ะะตะฝั โ  โ ะะะะะะ ะดะตะนััะฒะธะน
โโโโโโโโโโโดโโโโโโโโโโโค
โ    ๐ ะฃะดะฐะปะธัั       โ  โ ะะะะะะ ัะดะฐะปะตะฝะธั
โโโโโโโโโโโโโโโโโโโโโโค
โ     โฌ ะะฐะทะฐะด        โ  โ ะะะะะะ ะฝะฐะทะฐะด
โโโโโโโโโโโโโโโโโโโโโโ
```

### 3. **ะะฝะพะฟะบะฐ "ะะตะฐะบัะธะฒะฝัะต ะฐะบะบะฐัะฝัั"**
- ะะพะบะฐะทัะฒะฐะตั ะฟะพะปะฝัะน ัะฟะธัะพะบ ะฝะตะฐะบัะธะฒะฝัั ะฐะบะบะฐัะฝัะพะฒ
- ะก ะฟะฐะณะธะฝะฐัะธะตะน ะดะปั ัะดะพะฑะฝะพะน ะฝะฐะฒะธะณะฐัะธะธ

## ะขะตัะฝะธัะตัะบะธะต ะดะตัะฐะปะธ

### ะะทะผะตะฝัะฝะฝัะต ัะฐะนะปั

#### 1. `project/services/expiry_notifications.py`

**ะคัะฝะบัะธั `send_expired_notification`**:
- ะกะพััะฐะฝัะตั **ะพัะธะณะธะฝะฐะปัะฝัะน ัะพัะผะฐั ัะตะบััะฐ**
- ะะพะฑะฐะฒะปัะตั **inline keyboard ั ะบะฝะพะฟะบะฐะผะธ** ะฟะพะด ัะตะบััะพะผ
- ะะฐะถะดัะน ะฐะบะบะฐัะฝั = ะบะฝะพะฟะบะฐ ั callback `expiry_expired:{account_id}`

```python
async def send_expired_notification(bot, user: User, accounts: List[Account]):
    # Original message format (unchanged)
    message_lines = [
        "โ๏ธ <b>ะะะะะะะะ: ะััะตะบ ััะพะบ ะผะพะฝะธัะพัะธะฝะณะฐ!</b>\n",
        "๐ ะกะปะตะดัััะธะต ะฐะบะบะฐัะฝัั ะดะพััะธะณะปะธ ะบะพะฝัะฐ ะฟะตัะธะพะดะฐ ะผะพะฝะธัะพัะธะฝะณะฐ:"
    ]
    
    for acc in accounts:
        days_overdue = (date.today() - acc.to_date).days
        message_lines.append(
            f"โข <a href='https://www.instagram.com/{acc.account}/'>@{acc.account}</a> "
            f"(ะฟัะพััะพัะตะฝ ะฝะฐ {days_overdue} ะดะฝ.)"
        )
    
    message_lines.extend([
        "",
        "๐ <b>ะงัะพ ะดะตะปะฐัั:</b>",
        "1๏ธโฃ ะฃะฒะตะปะธัะธัั ะฟะตัะธะพะด ะผะพะฝะธัะพัะธะฝะณะฐ",
        "2๏ธโฃ ะฃะดะฐะปะธัั ะฐะบะบะฐัะฝั ะธะท ัะฟะธัะบะฐ",
        "",
        "๐ฑ ะัะฟะพะปัะทัะนัะต ะบะฝะพะฟะบั 'ะะตะฐะบัะธะฒะฝัะต ะฐะบะบะฐัะฝัั' ะดะปั ัะฟัะฐะฒะปะตะฝะธั"
    ])
    
    message = "\n".join(message_lines)
    
    # ADD BUTTONS UNDER THE MESSAGE
    keyboard = []
    for acc in accounts:
        days_overdue = (date.today() - acc.to_date).days
        button_text = f"@{acc.account} (ะฟัะพััะพัะตะฝ ะฝะฐ {days_overdue} ะดะฝ.)"
        keyboard.append([{
            "text": button_text,
            "callback_data": f"expiry_expired:{acc.id}"
        }])
    
    keyboard.append([{
        "text": "๐ฑ ะะตะฐะบัะธะฒะฝัะต ะฐะบะบะฐัะฝัั",
        "callback_data": "show_inactive_accounts"
    }])
    
    reply_markup = {"inline_keyboard": keyboard}
    await bot.send_message(user.id, message, reply_markup=reply_markup)
```

#### 2. `project/bot.py`

**ะะฑัะฐะฑะพััะธะบ callback `expiry_expired:`**:
- ะะพะบะฐะทัะฒะฐะตั ะบะฐััะพัะบั ะฐะบะบะฐัะฝัะฐ ะฟัะธ ะฝะฐะถะฐัะธะธ ะฝะฐ ะบะฝะพะฟะบั
- ะขะต ะถะต ะดะตะนััะฒะธั: ะดะพะฑะฐะฒะธัั/ัะฑัะฐัั ะดะฝะธ, ัะดะฐะปะธัั

```python
elif callback_data.startswith("expiry_soon:") or callback_data.startswith("expiry_expired:"):
    # Show account info from expiry notification
    acc_id = int(callback_data.split(":")[1])
    
    # Get account and show card with action buttons
    acc = get_account_by_id(s, acc_id)
    info_text = format_account_card(acc)
    
    keyboard = {
        "inline_keyboard": [
            [
                {"text": "โ ะะตะฝั", "callback_data": f"addd:{acc_id}"},
                {"text": "โ ะะตะฝั", "callback_data": f"subd:{acc_id}"}
            ],
            [{"text": "๐ ะฃะดะฐะปะธัั", "callback_data": f"delc:{acc_id}"}],
            [{"text": "โฌ ะะฐะทะฐะด", "callback_data": "close_expiry_info"}]
        ]
    }
    
    self.edit_message_text(chat_id, message_id, info_text, keyboard)
```

## Callback ััะตะผะฐ

```
ะฃะฒะตะดะพะผะปะตะฝะธะต ะพะฑ ะธััะตะบัะตะผ ััะพะบะต
    โโ ะขะตะบัั ัะพะพะฑัะตะฝะธั (ะพัะธะณะธะฝะฐะปัะฝัะน ัะพัะผะฐั)
    โโ Inline Keyboard:
        โโ @account1 (ะฟัะพััะพัะตะฝ ะฝะฐ X ะดะฝ.) โ expiry_expired:{id} โ ะะฐััะพัะบะฐ ะฐะบะบะฐัะฝัะฐ
        โโ @account2 (ะฟัะพััะพัะตะฝ ะฝะฐ Y ะดะฝ.) โ expiry_expired:{id} โ ะะฐััะพัะบะฐ ะฐะบะบะฐัะฝัะฐ
        โโ ๐ฑ ะะตะฐะบัะธะฒะฝัะต ะฐะบะบะฐัะฝัั โ show_inactive_accounts โ ะกะฟะธัะพะบ ะฝะตะฐะบัะธะฒะฝัั
```

## ะัะธะผะตัั ะธัะฟะพะปัะทะพะฒะฐะฝะธั

### ะัะธะผะตั 1: ะัะพะดะปะตะฝะธะต ะฟัะพััะพัะตะฝะฝะพะณะพ ะฐะบะบะฐัะฝัะฐ

1. **ะะพะปััะธะปะธ ัะฒะตะดะพะผะปะตะฝะธะต** ั ัะตะบััะพะผ ะธ ะบะฝะพะฟะบะฐะผะธ
2. **ะะฐะถะฐะปะธ ะฝะฐ ะบะฝะพะฟะบั** `@ukudarovvv (ะฟัะพััะพัะตะฝ ะฝะฐ 27 ะดะฝ.)`
3. **ะฃะฒะธะดะตะปะธ ะบะฐััะพัะบั** ะฐะบะบะฐัะฝัะฐ ั ะธะฝัะพัะผะฐัะธะตะน
4. **ะะฐะถะฐะปะธ `โ ะะตะฝั`**
5. **ะะฒะตะปะธ ะบะพะปะธัะตััะฒะพ ะดะฝะตะน**: `30`
6. **ะะตัะธะพะด ะฟัะพะดะปัะฝ!** โ

### ะัะธะผะตั 2: ะฃะดะฐะปะตะฝะธะต ะฟัะพััะพัะตะฝะฝะพะณะพ ะฐะบะบะฐัะฝัะฐ

1. **ะะฐะถะฐะปะธ ะฝะฐ ะบะฝะพะฟะบั** ั ะฟัะพััะพัะตะฝะฝัะผ ะฐะบะบะฐัะฝัะพะผ
2. **ะะฐะถะฐะปะธ `๐ ะฃะดะฐะปะธัั`**
3. **ะะพะดัะฒะตัะดะธะปะธ ัะดะฐะปะตะฝะธะต**
4. **ะะบะบะฐัะฝั ัะดะฐะปัะฝ!** โ

### ะัะธะผะตั 3: ะัะพัะผะพัั ะฒัะตั ะฝะตะฐะบัะธะฒะฝัั

1. **ะะฐะถะฐะปะธ `๐ฑ ะะตะฐะบัะธะฒะฝัะต ะฐะบะบะฐัะฝัั`**
2. **ะฃะฒะธะดะตะปะธ ัะฟะธัะพะบ** ะฒัะตั ะฝะตะฐะบัะธะฒะฝัั ะฐะบะบะฐัะฝัะพะฒ
3. **ะะพะถะฝะพ ะฟะตัะตะปะธัััะฒะฐัั** ัััะฐะฝะธัั

## ะัะตะธะผััะตััะฒะฐ ะฝะพะฒะพะณะพ ัะพัะผะฐัะฐ

โ **ะกะพััะฐะฝัะฝ ะพัะธะณะธะฝะฐะปัะฝัะน ัะตะบัั** - ะฟัะธะฒััะฝัะน ัะพัะผะฐั ัะฒะตะดะพะผะปะตะฝะธั  
โ **ะะพะฑะฐะฒะปะตะฝะฐ ะธะฝัะตัะฐะบัะธะฒะฝะพััั** - ะบะฝะพะฟะบะธ ะดะปั ะฑัััััั ะดะตะนััะฒะธะน  
โ **ะัััะธะน UX** - ะฝะต ะฝัะถะฝะพ ะธัะบะฐัั ะฐะบะบะฐัะฝัั ะฒ ะผะตะฝั  
โ **ะัััััะต ะดะตะนััะฒะธั** - ะฟัะพะดะปะธัั/ัะดะฐะปะธัั ะฟััะผะพ ะธะท ัะฒะตะดะพะผะปะตะฝะธั  
โ **ะะฑัะฐัะฝะฐั ัะพะฒะผะตััะธะผะพััั** - ัะตะบัั ะพััะฐะปัั ะฟัะตะถะฝะธะผ  

## ะกัะฐะฒะฝะตะฝะธะต ัะพัะผะฐัะพะฒ

### โ ะขะพะปัะบะพ ัะตะบัั (ะฑัะปะพ):
```
โ๏ธ ะะะะะะะะ: ะััะตะบ ััะพะบ ะผะพะฝะธัะพัะธะฝะณะฐ!
๐ ะกะปะตะดัััะธะต ะฐะบะบะฐัะฝัั ะดะพััะธะณะปะธ ะบะพะฝัะฐ ะฟะตัะธะพะดะฐ ะผะพะฝะธัะพัะธะฝะณะฐ:
โข @ukudarovvv (ะฟัะพััะพัะตะฝ ะฝะฐ 27 ะดะฝ.)
๐ ะงัะพ ะดะตะปะฐัั:
1๏ธโฃ ะฃะฒะตะปะธัะธัั ะฟะตัะธะพะด ะผะพะฝะธัะพัะธะฝะณะฐ
2๏ธโฃ ะฃะดะฐะปะธัั ะฐะบะบะฐัะฝั ะธะท ัะฟะธัะบะฐ
๐ฑ ะัะฟะพะปัะทัะนัะต ะบะฝะพะฟะบั 'ะะตะฐะบัะธะฒะฝัะต ะฐะบะบะฐัะฝัั' ะดะปั ัะฟัะฐะฒะปะตะฝะธั
```

### โ ะขะตะบัั + ะบะฝะพะฟะบะธ (ััะฐะปะพ):
```
โ๏ธ ะะะะะะะะ: ะััะตะบ ััะพะบ ะผะพะฝะธัะพัะธะฝะณะฐ!
๐ ะกะปะตะดัััะธะต ะฐะบะบะฐัะฝัั ะดะพััะธะณะปะธ ะบะพะฝัะฐ ะฟะตัะธะพะดะฐ ะผะพะฝะธัะพัะธะฝะณะฐ:
โข @ukudarovvv (ะฟัะพััะพัะตะฝ ะฝะฐ 27 ะดะฝ.)
๐ ะงัะพ ะดะตะปะฐัั:
1๏ธโฃ ะฃะฒะตะปะธัะธัั ะฟะตัะธะพะด ะผะพะฝะธัะพัะธะฝะณะฐ
2๏ธโฃ ะฃะดะฐะปะธัั ะฐะบะบะฐัะฝั ะธะท ัะฟะธัะบะฐ
๐ฑ ะัะฟะพะปัะทัะนัะต ะบะฝะพะฟะบั 'ะะตะฐะบัะธะฒะฝัะต ะฐะบะบะฐัะฝัั' ะดะปั ัะฟัะฐะฒะปะตะฝะธั

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ @ukudarovvv (ะฟัะพััะพัะตะฝ ะฝะฐ 27 ะดะฝ.) โ  โ ะะะะะะ!
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ ๐ฑ ะะตะฐะบัะธะฒะฝัะต ะฐะบะบะฐัะฝัั           โ  โ ะะะะะะ!
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ะขะตััะธัะพะฒะฐะฝะธะต

ะะปั ัะตััะธัะพะฒะฐะฝะธั ะธัะฟะพะปัะทัะนัะต:

```bash
# ะขะตัั ัะฒะตะดะพะผะปะตะฝะธะน ะพะฑ ะธััะตะบัะตะผ ััะพะบะต
python test_expired_notification.py
```

## ะะฐัะฐ ะพะฑะฝะพะฒะปะตะฝะธั

16 ะพะบััะฑัั 2025

